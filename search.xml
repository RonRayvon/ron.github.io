<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Linux æœºå™¨ç£ç›˜æ¸…ç†</title>
    <url>/ron.github.io/2024/11/01/Linux%E6%9C%BA%E5%99%A8%E7%A3%81%E7%9B%98%E6%B8%85%E7%90%86/</url>
    <content><![CDATA[<h2 id="Linux-æœºå™¨ç£ç›˜æ¸…ç†"><a href="#Linux-æœºå™¨ç£ç›˜æ¸…ç†" class="headerlink" title="Linux æœºå™¨ç£ç›˜æ¸…ç†"></a>Linux æœºå™¨ç£ç›˜æ¸…ç†</h2><p>æ—©ä¸Šæ”¶åˆ°ä¸€ä»½å‘Šè­¦ï¼Œæé†’ç£ç›˜ç©ºé—´å†…å­˜å ç”¨è¶…è¿‡ 95%ã€‚</p>
<p>å¯¹äºå‰ç«¯å¼€å‘æ¥è¯´ï¼Œå‰ç«¯å¤§éƒ¨åˆ†çš„æœåŠ¡æ˜¯é™æ€èµ„æºï¼ˆReact ã€Vue ç­‰å¼€å‘çš„é¡µé¢æ‰“åŒ…æ„å»ºåäº§ç‰© css\js\html ä»¥åŠå…¶ä»–åª’ä½“èµ„æºå’Œå­—ä½“ç­‰é™æ€èµ„æºï¼‰å¹¶ä¸ä¼šå ç”¨è¿‡å¤šçš„å†…å­˜ã€‚</p>
<p>è¿‘æœŸä½¿ç”¨ strapi æ­å»ºäº†ä¸€ä¸ªåŸºäºnodeçš„æœåŠ¡ï¼Œç”¨äº lowcode ç¼–æ’çš„å†…å®¹çš„CRUDã€‚æœ¬æ–‡è®°å½•å¦‚ä½•æ¸…ç†ç£ç›˜ã€‚</p>
<p><img data-src="/ron.github.io/images/67e368da-3205-4fa2-84e9-5f852bc9e475.png" alt="image.png"></p>
<p>åˆ†ä¸ºä¸‰æ­¥ï¼šæŸ¥è¯¢ç£ç›˜å ç”¨æƒ…å†µã€å®šä½å†…å­˜æš´æ¶¨ç›®å½•ã€æ¸…ç†å†…å®¹</p>
<h2 id="æŸ¥è¯¢ç£ç›˜"><a href="#æŸ¥è¯¢ç£ç›˜" class="headerlink" title="æŸ¥è¯¢ç£ç›˜"></a>æŸ¥è¯¢ç£ç›˜</h2><p>å‘½ä»¤  <code>df -h</code>     dfã€disk freeã€‘å‘½ä»¤ç”¨äºæ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬å·²ç”¨ç©ºé—´å’Œå¯ç”¨ç©ºé—´ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">df</span> -h </span><br></pre></td></tr></table></figure>

<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">overlay          20G  19.6G  0    98% /</span><br><span class="line">tmpfs            64M     0   64M   0% /dev</span><br><span class="line">tmpfs           252G     0  252G   0% /sys/fs/cgroup</span><br><span class="line">/dev/md0p3      218G   14G  193G   7% /etc/hosts</span><br><span class="line">shm              64M     0   64M   0% /dev/shm</span><br><span class="line">/dev/md1        3.7T  2.1T  1.7T  56% /etc/hostname</span><br><span class="line">tmpfs           252G   12K  252G   1% /run/secrets/kubernetes.io/serviceaccount</span><br><span class="line">tmpfs           252G     0  252G   0% /proc/acpi</span><br><span class="line">tmpfs           252G     0  252G   0% /proc/scsi</span><br><span class="line">tmpfs           252G     0  252G   0% /sys/firmware</span><br></pre></td></tr></table></figure>

<p>ç£ç›˜é’ˆå¯¹ meta æ•°æ®é¢„ç•™çš„å†…å­˜æ˜¯ 20G, å†…å­˜å ç”¨98%ã€‚ä» overlay æ–‡ä»¶ç³»ç»Ÿå ç”¨æ¯”è¾ƒå¤§ã€‚ä»è¿™ä¸€æ­¥å®šä½åˆ°å‘Šè­¦æ‰€åœ¨çš„æœºå™¨çš„ç£ç›˜å ç”¨æƒ…å†µã€‚ä¸‹ä¸€æ­¥éœ€è¦å®šä½åˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ç›®å½•ã€‚</p>
<h2 id="å®šä½åˆ°ç£ç›˜å¤§å†…å­˜æ–‡ä»¶ç›®å½•"><a href="#å®šä½åˆ°ç£ç›˜å¤§å†…å­˜æ–‡ä»¶ç›®å½•" class="headerlink" title="å®šä½åˆ°ç£ç›˜å¤§å†…å­˜æ–‡ä»¶ç›®å½•"></a>å®šä½åˆ°ç£ç›˜å¤§å†…å­˜æ–‡ä»¶ç›®å½•</h2><p>å‘½ä»¤  <code>du -sh * | sort -h</code>  ï¼Œå‘½ä»¤å«ä¹‰ï¼šæŸ¥è¯¢å½“å‰ç›®å½•ä¸‹ä¸€çº§ç›®å½•çš„æ¯ä¸ªæ–‡ä»¶å’Œå­ç›®å½•çš„å¤§å°ï¼Œå¹¶æŒ‰å¤§å°æ’åºã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">du</span> -sh * | <span class="built_in">sort</span> -h</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0       sshd</span><br><span class="line">0       sysrd</span><br><span class="line">12K     logger</span><br><span class="line">12K     rd</span><br><span class="line">528M    odin</span><br><span class="line">19.6G    xiaoju</span><br></pre></td></tr></table></figure>

<p>å®šä½æ˜¯ xiaoju ç›®å½•ï¼Œè¿›å…¥xiaojuæ–‡ä»¶å¤¹ç»§ç»­æŸ¥çœ‹å†…å­˜åˆ†å¸ƒã€‚ä¸€æ­¥åˆ°ä½çš„å‘½ä»¤æ˜¯ <code>du -h -l</code> å°†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å…¨åˆ—å‡ºæ¥å¹¶æ ‡è®°å‡ºæ–‡ä»¶å¤§å°ã€‚â€“max-depth æ§åˆ¶æ–‡ä»¶ç›®å½•æ·±åº¦ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> xiaoju <span class="comment"># è¿›å…¥ç¬¬ä¸€æ­¥åˆ†æå‡ºæ¥çš„å¤§å†…å­˜å æ¯”æ–‡ä»¶å¤¹ä¸‹</span></span><br><span class="line"><span class="built_in">du</span> -h -l --max-depth=1  </span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢ç»“æœï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">11M     ./opbin</span><br><span class="line">44K     ./meta</span><br><span class="line">861M    ./data1</span><br><span class="line">776M    ./strapi-lowcode-server</span><br><span class="line">44M     ./ep</span><br><span class="line">4.0K    ./statsd-client</span><br><span class="line">24M     ./.npm</span><br><span class="line">213M    ./node-v20.14.0-linux-x64</span><br><span class="line">2.1G    ./.cache</span><br><span class="line">43M     ./.config</span><br><span class="line">0       ./.yarn</span><br><span class="line">15.4G    ./.pm2</span><br><span class="line">788K    ./elvish</span><br><span class="line">230M    ./python3</span><br><span class="line">19.6G    .</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°äº†å¤§éƒ¨åˆ†å†…å­˜å¯æ¸…ç†çš„èŒƒå›´äº† pm2 è¿›ç¨‹å®ˆæŠ¤ï¼Œè¿›ç¨‹æ—¥å¿—ç­‰å ç”¨äº†15.6Gå†…å­˜ï¼Œå…¶ä»–å°±æ˜¯cacheå ç”¨2Gã€‚å®šä½åˆ°åŸå› å¤§æ¦‚å°±æ˜¯ pm2 æœªé…ç½®å†…å­˜å ç”¨å¤§å°ï¼Œçœ‹äº†ä¸€ä¸‹è¿›ç¨‹æ—¥å¿—éƒ½ä¸å¤ªé‡è¦å¯ä»¥è¿›è¡Œæ¸…ç†ã€‚</p>
<h2 id="æ¸…ç†å¤§å†…å­˜ç›®å½•"><a href="#æ¸…ç†å¤§å†…å­˜ç›®å½•" class="headerlink" title="æ¸…ç†å¤§å†…å­˜ç›®å½•"></a>æ¸…ç†å¤§å†…å­˜ç›®å½•</h2><p>å¦‚æœæ˜¯ç‰¹æ®Šç¨‹åºè¿è¡Œå¯¼è‡´çš„å†…å­˜æš´æ¶¨ï¼Œåˆ™éœ€è¦è€ƒè™‘å°†ç¨‹åºè¿å‡ºï¼Œæˆ–æ˜¯å°†ç¨‹åºè¿è¡Œäº§ç‰©åŠæ—¶åŒæ­¥æ‰å°†å†…å­˜é‡Šæ”¾ï¼ˆè¿™ä¸€æ­¥åº”è¯¥åšæˆè‡ªåŠ¨åŒ–ï¼‰ã€‚</p>
<p>å¯¹äºå½“å‰æˆ‘é‡åˆ°çš„åœºæ™¯ï¼Œåªéœ€è¦å°† pm2 è¿›ç¨‹æ—¥å¿—å ç”¨çš„å†…å­˜ flush å³å¯ã€‚æ­¥éª¤æœ‰ä¸¤ç‚¹ï¼šç¬¬ä¸€å…ˆå°†æœºå™¨çš„ .pm2&#x2F; ä¸‹çš„å†…å­˜é‡Šæ”¾æ‰ï¼›ç¬¬äºŒï¼šä¿®æ”¹éƒ¨ç½²ç¨‹åºè„šæœ¬ï¼Œå°†å†…å­˜å ç”¨é™åˆ¶ä¸º5Gã€‚</p>
<p>æ‰‹åŠ¨æ¸…ç†æ—¥å¿—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pm2 flush <span class="comment"># æ‰‹åŠ¨æ¸…ç†æ—¥å¿—</span></span><br></pre></td></tr></table></figure>

<p> å¢åŠ  pm2-logrotate è‡ªåŠ¨ç®¡ç†æ—¥å¿—å¤§å°ï¼Œä¿®æ”¹ max_memory_restart é…ç½®é¡¹é™åˆ¶å†…å­˜å¤§å°ã€‚</p>
<h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p>æ¸…ç†å®Œæˆåé‡æ–°æŸ¥è¯¢ç£ç›˜å æ¯”ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">du</span> -h  -l --max-depth=1</span><br></pre></td></tr></table></figure>

<p>é‡Šæ”¾æ‰ 10Gçš„å†…å­˜å ç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">11M     ./opbin</span><br><span class="line">44K     ./meta</span><br><span class="line">861M    ./data1</span><br><span class="line">776M    ./strapi-lowcode-server</span><br><span class="line">44M     ./ep</span><br><span class="line">4.0K    ./statsd-client</span><br><span class="line">24M     ./.npm</span><br><span class="line">213M    ./node-v20.14.0-linux-x64</span><br><span class="line">2.1G    ./.cache</span><br><span class="line">43M     ./.config</span><br><span class="line">0       ./.yarn</span><br><span class="line">5.4G    ./.pm2</span><br><span class="line">788K    ./elvish</span><br><span class="line">230M    ./python3</span><br><span class="line">9.6G    .</span><br></pre></td></tr></table></figure>

<p>du -h -l æŸ¥çœ‹å ç”¨æƒ…å†µ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">overlay          20G  9.0G   12G  45% /</span><br><span class="line">tmpfs            64M     0   64M   0% /dev</span><br><span class="line">tmpfs           252G     0  252G   0% /sys/fs/cgroup</span><br><span class="line">/dev/md0p3      218G   14G  193G   7% /etc/hosts</span><br><span class="line">shm              64M     0   64M   0% /dev/shm</span><br><span class="line">/dev/md1        3.7T  2.1T  1.7T  56% /etc/hostname</span><br><span class="line">tmpfs           252G   12K  252G   1% /run/secrets/kubernetes.io/serviceaccount</span><br><span class="line">tmpfs           252G     0  252G   0% /proc/acpi</span><br><span class="line">tmpfs           252G     0  252G   0% /proc/scsi</span><br><span class="line">tmpfs           252G     0  252G   0% /sys/firmware</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>PROGRAMMING</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>v8å¼•æ“ç³»åˆ—ä¹‹è§£é‡Š&amp;ç¼–è¯‘</title>
    <url>/ron.github.io/2024/11/14/v8%E5%BC%95%E6%93%8E%E7%B3%BB%E5%88%97%E4%B9%8B%E7%BC%96%E8%AF%91%E5%92%8C%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<!-- # V8 å¼•æ“è¿è¡Œ JSä»£ç  â€”  -->

<p>V8 å¼•æ“æ˜¯ JS è¿è¡Œå¼•æ“ä¸­çš„ä¸€ç§ï¼Œåœ¨æµè§ˆå™¨å’Œnodeä¸­æ¯”è¾ƒå¸¸è§ã€‚æ–°å¼€V8å¼•æ“ç³»åˆ—æ–‡ç« ï¼Œç ”ç©¶æ¢ç´¢å¼•æ“èƒŒåçš„è°ƒç”¨æµç¨‹å’Œè®¾è®¡æ€è·¯ã€‚V8å¼•æ“ç³»åˆ—æ–‡ç« ä¸»è¦å‚è€ƒV8å¼•æ“å¼€æºæºç ï¼Œè¾…åŠ©å¼€æºç¤¾åŒºèµ„æ–™ï¼ˆéƒ¨åˆ†èµ„æ–™å·²ç»è¿‡æ—¶ï¼‰è¿›è¡Œæ€»ç»“ã€‚å¦‚æœ‰æ€»ç»“é”™è¯¯ä¹‹å¤„ï¼Œæœ›ä¸åèµæ•™ï¼Œåœ¨æ­¤æ‹œè°¢ã€‚</p>
<h2 id="å‰ç½®-èƒŒæ™¯"><a href="#å‰ç½®-èƒŒæ™¯" class="headerlink" title="å‰ç½®-èƒŒæ™¯"></a>å‰ç½®-èƒŒæ™¯</h2><h3 id="ä»€ä¹ˆæ˜¯-V8å¼•æ“"><a href="#ä»€ä¹ˆæ˜¯-V8å¼•æ“" class="headerlink" title="ä»€ä¹ˆæ˜¯ V8å¼•æ“"></a>ä»€ä¹ˆæ˜¯ V8å¼•æ“</h3><p>V8 æ˜¯ä¸€ä¸ªC++ç¼–å†™çš„ç¨‹åºï¼Œå®ƒç”¨äºç¼–è¯‘æ‰§è¡ŒJavaScriptä»£ç ã€‚æä¾›ä»¥ä¸‹åŸºç¡€èƒ½åŠ›ï¼š</p>
<div class="note info"><p>ğŸ’¡<br>1ã€ç¼–è¯‘å¹¶æ‰§è¡ŒJSä»£ç </p>
<p>2ã€ä»¥æŸç§é¡ºåºæ‰§è¡Œå‡½æ•°ï¼Œå¤„ç†è°ƒç”¨æ ˆ</p>
<p>3ã€ç®¡ç†å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œå †å†…å­˜</p>
<p>4ã€åƒåœ¾å›æ”¶</p>
<p>5ã€æä¾›æ‰€æœ‰ JS è¯­è¨€æ”¯æŒçš„æ•°æ®ç±»å‹ã€è¿ç®—ç¬¦ã€API å’Œå…¬å…±å‡½æ•°</p>
</div>

<p>V8 æä¾›å¯é€‰äº‹ä»¶å¾ªç¯ï¼ˆæµè§ˆå™¨ä¸­è¿è¡ŒJSæ—¶ï¼Œäº‹ä»¶å¾ªç¯ç”±æµè§ˆå™¨æä¾›ï¼‰ã€‚V8 æ˜¯ä¸€ä¸ªå•çº¿ç¨‹è¿è¡ŒJSä»£ç çš„å¤šçº¿ç¨‹åº”ç”¨ï¼ŒV8å¼•æ“æœ¬èº«æ˜¯å¤šçº¿ç¨‹ç¨‹åºï¼ŒV8é‡‡ç”¨å•çº¿ç¨‹è¿è¡ŒJSä»£ç ã€‚</p>
<div class="note info no-icon"><p>ğŸ’¡<br>V8è¿è¡ŒJSä»£ç æ˜¯æ˜¯å•çº¿ç¨‹ã€‚ä¸€ä¸ªV8å®ä¾‹ï¼Œè¿è¡Œä¸€ä¸ªå•ç‹¬çš„JSæ‰§è¡Œä¸Šä¸‹æ–‡ã€‚åœ¨æµè§ˆå™¨æˆ–è€… node.js å¼€å‘çš„è¿›ç¨‹ä¸­å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªV8çº¿ç¨‹å®ä¾‹æ¥å®ç°å¤šçº¿ç¨‹å¹¶å‘ï¼Œæ¯”å¦‚ï¼šé€šè¿‡WebWorkerç­‰æŠ€æœ¯å¼€è¾Ÿæ–°çš„æ‰§è¡ŒJSä¸Šä¸‹æ–‡å¹¶è°ƒç”¨V8çº¿ç¨‹æ‰§è¡Œã€‚</p>
</div>

<p>V8 å¼•æ“å†…éƒ¨å¤šçº¿ç¨‹å¤§ä½“åˆ’åˆ†ä¸ºå‡ ç±»ï¼š</p>
<div class="note info no-icon"><p>ğŸ’¡<br>1ã€ä¸»çº¿ç¨‹ï¼šè´Ÿè´£æ‰§è¡Œ JS ä»£ç è§£æã€ç¼–è¯‘ã€è¿è¡Œã€‚å¤„ç†æ‰€æœ‰å…³äº JS ä»£ç æ‰§è¡Œç›¸å…³çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬è°ƒç”¨æ ˆç®¡ç†å’Œäº‹ä»¶å¾ªç¯ã€‚</p>
<p>2ã€åƒåœ¾å›æ”¶çº¿ç¨‹ï¼šè´Ÿè´£è‡ªåŠ¨ç®¡ç†å†…å­˜ã€‚</p>
<p>3ã€TurboFan ç¼–è¯‘çº¿ç¨‹ï¼š V8 æ‰§è¡ŒJSä»£ç è¿‡ç¨‹ä¸­ä¼šæ ‡è®° hot ä»£ç ï¼ŒTurboFan çº¿ç¨‹ä¼šå°† hot ä»£ç ç¼–è¯‘ä¼˜åŒ–ï¼Œé€šå¸¸hotä»£ç ä¼šè¢«è½¬æ¢ä¸ºæœºå™¨ç ã€‚</p>
<p>4ã€I&#x2F;Oçº¿ç¨‹ï¼šnode.js ç¯å¢ƒä¸­ä¸ libuv é›†æˆã€‚è´Ÿè´£æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼Œç½‘ç»œè¯·æ±‚ç­‰ç­‰I&#x2F;Oæ“ä½œã€‚</p>
<p>5ã€å…¶ä»–è¾…åŠ©çº¿ç¨‹ï¼šdebugã€æ€§èƒ½åˆ†æç­‰ç­‰</p>
</div>

<p>V8 å¼•æ“è¿è¡Œ JS ä»£ç æµç¨‹å¤§ä½“å¦‚ä¸‹ï¼š</p>
<p><img data-src="/ron.github.io/images/v8/2411/image.png" alt="image.png"></p>
<p>V8 åªè´Ÿè´£æ‰§è¡Œ JSï¼Œéƒ¨åˆ†è¿è¡Œç¯å¢ƒéœ€è¦è°ƒç”¨å®¿ä¸»æä¾›ã€‚</p>
<h3 id="Host-Env-è¿è¡Œç¯å¢ƒ"><a href="#Host-Env-è¿è¡Œç¯å¢ƒ" class="headerlink" title="Host Env è¿è¡Œç¯å¢ƒ"></a>Host Env è¿è¡Œç¯å¢ƒ</h3><p>V8çš„è¿è¡Œå®¿ä¸»ç¯å¢ƒæœ‰å¤šç§ï¼Œæœ€ä¸ºå¸¸è§çš„æ˜¯æµè§ˆå™¨ Browser å’Œ NodeJS ã€‚Browser ç¯å¢ƒå’Œ NodeJS ç¯å¢ƒæœ‰ç›¸åŒçš„æˆå‘˜å¦‚ï¼šECMAScript standard ï¼ˆJavaScriptæ ¸å¿ƒå†…ç½®APIï¼‰ã€å‡½æ•°è°ƒç”¨æ ˆã€Heap å†…å­˜ã€åƒåœ¾å›æ”¶ç­‰ç­‰ã€‚ä¸ä¸€è‡´çš„åœ¨äºç‰¹æ®Š API + äº‹ä»¶å¾ªç¯ã€‚</p>
<p>ç‰¹æ®Šç‚¹å¦‚ä¸‹ï¼š</p>
<p>Browser ç¯å¢ƒï¼š</p>
<div class="note info no-icon"><p>ğŸ’¡<br><strong>Web API</strong>:  æµè§ˆå™¨æä¾›çš„æ¥å£ï¼Œç”¨äºç¨‹åºå’Œæµè§ˆå™¨äº¤äº’ Canvasã€ServiceWorkerã€WebStorageã€Fetchã€ Audio&#x2F;Videoã€Geolocationç­‰ç­‰</p>
<p><strong>DOM API</strong>ï¼šæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼Œç”¨äºå¯¹ HTML è¿›è¡Œæ“ä½œã€‚ä¸»è¦åŒ…å«ä»¥ä¸‹æ–¹é¢ API åŠŸèƒ½Element CRUDã€Event Handing äº‹ä»¶ç›‘å¬å¤„ç†ã€CSSOM æ ·å¼è¡¨ä¿®æ”¹ </p>
<p><strong>Event Loop</strong>: æµè§ˆå™¨å•ç‹¬æä¾›çš„æ—¶é—´å¾ªç¯ä¸æ¸²æŸ“å‘¨æœŸç»“åˆ</p>
</div>

<p>NodeJS ç¯å¢ƒï¼š</p>
<div class="note info no-icon"><p>ğŸ’¡<br><strong>æ–‡ä»¶ç³»ç»Ÿ API</strong>ï¼š fs æ¨¡å—ï¼Œè§£å†³ i&#x2F;o è¯»å†™</p>
<p><strong>ç½‘ç»œ API</strong>ï¼šhttpã€httpsã€netç­‰æ¨¡å—</p>
<p><strong>ç¯å¢ƒå˜é‡ proces</strong> ï¼šç¯å¢ƒå˜é‡ç»´æŠ¤</p>
<p><strong>Clusteré›†ç¾¤å’Œå­çº¿ç¨‹</strong>ï¼šå¤šçº¿ç¨‹å¹¶å‘API</p>
<p><strong>å…¶ä»–æ¨¡å—</strong>ï¼š C++ æ¨¡å— </p>
<p><strong>Event Loop</strong>ï¼šNodeJS çš„ Event Loopé‡‡ç”¨äº†å¤šé˜¶æ®µè®¾è®¡ï¼Œå…è®¸æ›´ç»†ç²’åº¦çš„æ§åˆ¶</p>
</div>

<p><img data-src="/ron.github.io/images/v8/2411/image%201.png" alt="image.png"></p>
<p>äº‹ä»¶é©±åŠ¨æ¨¡å‹ä¸­å”¤èµ·çš„å›è°ƒï¼Œç»è¿‡äº‹ä»¶å¾ªç¯è°ƒç”¨V8å¼•æ“æ‰§è¡Œã€‚é¡µé¢äº‹ä»¶&#x2F;æµè§ˆå™¨ç”Ÿå‘½å‘¨æœŸ&#x2F;WebAPI ç­‰ç­‰æ¥æºè§¦å‘çš„å›è°ƒå‡½æ•°ï¼Œè¢«æ·»åŠ åˆ°äº‹ä»¶å¾ªç¯çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€è¿™é‡Œä¹Ÿå¯ç§°ä¹‹ä¸ºå®ä»»åŠ¡é˜Ÿåˆ—ã€‘ã€‚äº‹ä»¶å¾ªç¯ä¸å¾®ä»»åŠ¡é˜Ÿåˆ—çš„å…³ç³»åœ¨æœ¬æ–‡ä¸­ä¸ä¼šæ·±å…¥ï¼Œä¼šå•å¼€ä¸€æ–‡ã€‚</p>
<p>ä»¥æµè§ˆå™¨ç¯å¢ƒè°ƒç”¨V8è¿è¡ŒJSä¸ºä¾‹</p>
<p><img data-src="/ron.github.io/images/v8/2411/image%202.png" alt="image.png"></p>
<p>åˆ°æ­¤ï¼Œæ­£å¼è¿›å…¥ JS ä»£ç å¦‚ä½•åœ¨å¼•æ“ä¸­è¿è¡Œè¿‡ç¨‹ã€‚ç¬¬ä¸€æ­¥æ˜¯ï¼šè§£é‡Šæ‰§è¡Œç¼–è¯‘ä¼˜åŒ–</p>
<h2 id="ç¼–è¯‘-è¿è¡Œ"><a href="#ç¼–è¯‘-è¿è¡Œ" class="headerlink" title="ç¼–è¯‘ &amp; è¿è¡Œ"></a>ç¼–è¯‘ &amp; è¿è¡Œ</h2><h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><p>V8 å¼•æ“å°†JSä»£ç ç¼–è¯‘è½¬æ¢æˆå­—èŠ‚ç å’Œéƒ¨åˆ†æœºå™¨ç ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<div class="note info no-icon"><p>ğŸ’¡</p>
<ol>
<li>è§£æå™¨å°† JS Code è§£æè½¬æ¢æˆ AST å¹¶åˆ†æå‡ºå…³è”çš„ Scopes ä½œç”¨åŸŸï¼Œ æ„å»ºAST çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºè§£æ Parseã€‚</li>
<li>éšåè¿›è¡Œç¬¬ä¸€æ¬¡ç¼–è¯‘ AST + Scopes ç¼–è¯‘è½¬æ¢æˆå­—èŠ‚ç ï¼Œ ç¬¬ä¸€ä¸ªç¼–è¯‘å™¨åå­—å«åš Ignition ï¼Œignition å°† AST è½¬å˜æˆ bytecode å­—èŠ‚ç ã€‚</li>
<li>è§£é‡Šæ‰§è¡Œå­—èŠ‚ç ã€‚å­—èŠ‚ç è¢«è§£é‡Šå™¨ inceptor è§£é‡Šæ‰§è¡Œï¼Œè§£é‡Šæ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šè¿›è¡Œä»£ç ä¼˜åŒ–æ ‡è®°ï¼Œã€‚</li>
<li>IC ä¼˜åŒ–ã€‚</li>
<li>Hot ä»£ç ä¸‰çº§ä¼˜åŒ–ï¼Œè½¬æˆæœºå™¨ç ã€‚é’ˆå¯¹Hotä»£ç ï¼ŒV8å¼•æ“ç›®å‰é‡‡ç”¨ä¸‰çº§ä¼˜åŒ–æ¨¡å¼ã€‚åˆ†åˆ«æ˜¯ï¼šSparkplugã€Maglevã€TurboFan ã€‚ä¸‰ä½å¤§å¸ˆè´Ÿè´£å°†æ ‡è®°ä¸º Hot ä»£ç è¿›ä¸€æ­¥ç¼–è¯‘æˆä¸ºæœºå™¨ç ï¼Œä»¥æ­¤æå‡ä»£ç è¿è¡Œé€Ÿåº¦ã€‚æœºå™¨ç è¢« CPU ç›´æ¥è¿è¡Œã€‚</li>
</ol>
</div>

<p><img data-src="/ron.github.io/images/v8/2411/image%203.png" alt="image.png"></p>
<p>åˆ°äº†è¿™é‡Œä¼šæœ‰ä¸¤ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆä¸å…¨éƒ¨ç¼–è¯‘æˆä¸ºæœºå™¨ç ï¼Ÿç¬¬äºŒä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¿›è¡Œä¼˜åŒ–ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šé€€å‡ºä¼˜åŒ–ï¼Ÿ</p>
<div class="note info no-icon"><p>ğŸ’¡</p>
<ul>
<li><strong>æœ€å¿«çš„å¯åŠ¨è¿è¡Œå’Œä¸å¤ªå¤§çš„å†…å­˜ã€‚</strong><ul>
<li>JIT ç¼–è¯‘æˆä¸ºå­—èŠ‚ç èƒ½å¤ŸèŠ‚çº¦æ—¶é—´ï¼Œç›´æ¥ç¼–è¯‘æˆæœºå™¨ç éœ€è¦åˆ†ææ•´ä¸ªJSè„šæœ¬æ¨æ–­æ‰€æœ‰å¯¹è±¡ç±»å‹å’Œä¼˜åŒ–æ¡ä»¶ã€‚Web ç«™ç‚¹å¿«é€ŸåŠ è½½ã€å“åº”æµç•…éœ€è¦æœ€å¿«å¯åŠ¨JSè„šæœ¬æ‰§è¡Œã€‚</li>
<li>å¤§éƒ¨åˆ†JSä»£ç ä¸ä¼šé‡å¤è¿è¡Œï¼Œè¿è¡Œåˆå§‹ç¼–è¯‘æˆæœºå™¨ç è€—æ—¶å¤šä¸”å†…å­˜å ç”¨éå¸¸å¤§ã€‚</li>
</ul>
</li>
<li><strong>JS è¯­è¨€ç‰¹æ€§ï¼šåŠ¨æ€ç±»å‹ä¸ç¡®å®šæ€§</strong><ul>
<li>è¿è¡Œæ—¶é¢‘ç¹ä¿®æ”¹å˜é‡ç±»å‹ï¼Œæœªè¿è¡Œå‰æ— æ³•æ¨æ–­å‡†ç¡®çš„ç±»å‹ã€‚</li>
<li>é€šè¿‡è§£é‡Šå™¨ Ignition è¿è¡Œå­—èŠ‚ç æ—¶ï¼Œæ ‡è®°å˜é‡ç±»å‹ç»“æ„å›ºå®šä¸”é¢‘ç¹æ‰§è¡Œçš„ ä»£ç ä¸º Hotï¼Œå°†Hotä»£ç¼–è¯‘æˆç æœºå™¨ç æå‡è¿è¡Œé€Ÿç‡ã€‚</li>
</ul>
</li>
<li><strong>è·¨å¹³å°å…¼å®¹æ€§</strong><ul>
<li>bytecode ä¸å¹³å°æ— å…³ï¼Œå¯ä»¥åœ¨ä¸åŒçš„ç¡¬ä»¶æ¶æ„ä¸Šè¿è¡Œã€‚æœºå™¨ç ç”± CPU ç›´æ¥è¿è¡Œï¼Œä¸ CPU æ¶æ„ä»¥åŠæ”¯æŒçš„ç¼–ç å¼ºç›¸å…³ã€‚</li>
</ul>
</li>
</ul>
</div>

<h3 id="å­—èŠ‚ç -VS-æœºå™¨ç "><a href="#å­—èŠ‚ç -VS-æœºå™¨ç " class="headerlink" title="å­—èŠ‚ç  VS æœºå™¨ç "></a>å­—èŠ‚ç  VS æœºå™¨ç </h3><p>ç¼–è¯‘æœ‰ä¸¤ç§å¸¸è§çš„æ¨¡å¼ JIT ï¼ˆjust in timeï¼‰å³æ—¶ç¼–è¯‘å’Œ AOTï¼ˆAhead of timeï¼‰æå‰ç¼–è¯‘ã€‚JIT æ˜¯åœ¨ä»£ç è¿è¡ŒæœŸé—´åŠ¨æ€ç¼–è¯‘ï¼Œç¼–è¯‘-è¿è¡Œ-ç¼–è¯‘-è¿è¡Œã€‚AOT ä¸€èˆ¬å¸¸è§äºC++ å’Œ JAVA è¿™ç±»å¼ºç±»å‹è¯­è¨€ï¼Œæ‰“åŒ…æ„å»ºæ—¶ç›´æ¥äº§å‡ºå­—èŠ‚ç æˆ–æœºå™¨ç ã€‚V8 å¼•æ“ç¼–è¯‘JSä»£ç é‡‡ç”¨çš„æ˜¯ JITç¼–è¯‘æ¨¡å¼ã€‚</p>
<p>V8 æ‰§è¡Œ JS ä»£ç è¿‡ç¨‹ä¸­å…ˆç¿»è¯‘æˆ bytecodeï¼Œ å¤šæ¬¡è¿è¡Œä¼šæ ‡è®°å¯è¢«ä¼˜åŒ–çš„ä»£ç æ ‡è®°ä¸º Hot TuboFan å°† Hot ä»£ç ä» bytecode ç¼–è¯‘æˆæœºå™¨ç ï¼ŒåŠ é€Ÿè¿è¡Œã€CPUç›´æ¥è¿è¡Œæœºå™¨ç ã€‘ã€‚</p>
<p><img data-src="/ron.github.io/images/v8/2411/image%204.png" alt="image.png"></p>
<p>V8 æä¾›çš„å­—èŠ‚ç æ˜ å°„è¡¨ï¼š</p>
<p><a href="https://github.com/v8/v8/blob/master/src/interpreter/bytecodes.h">https://github.com/v8/v8/blob/master/src/interpreter/bytecodes.h</a></p>
<p>10k çš„ JS ä»£ç å°±å…¨ç¼–è¯‘æˆæœºå™¨ç éœ€è¦ 20M çš„ç©ºé—´ï¼Œ1Mçš„JSä»£ç åˆ™éœ€è¦çº¦ 2G çš„å†…å­˜ç©ºé—´ã€‚</p>
<p>V8é‡‡ç”¨æŠ˜ä¸­æ–¹æ¡ˆï¼šè§£é‡Šæ‰§è¡Œå¤§éƒ¨åˆ†ä»£ç ï¼Œå¯¹éƒ¨åˆ†é«˜é¢‘ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚</p>
<h2 id="V8-å¼•æ“è¿è¡Œä¼˜åŒ–"><a href="#V8-å¼•æ“è¿è¡Œä¼˜åŒ–" class="headerlink" title="V8 å¼•æ“è¿è¡Œä¼˜åŒ–"></a>V8 å¼•æ“è¿è¡Œä¼˜åŒ–</h2><p>V8 å¼•æ“ä¼˜åŒ– â€œ<strong>åœ¨å†…å­˜ã€CPUã€ç­‰èµ„æºåˆé€‚çš„æƒ…å†µä¸‹ï¼Œä¼˜åŒ–è°ƒç”¨é¢‘ç¹ï¼›ç±»å‹ç»“æ„ç¨³å®šï¼›æ‰§è¡Œæ—¶é—´é•¿ï¼›ä»£ç è§„æ¨¡é€‚ä¸­ï¼›ä»£ç æ§åˆ¶æµç¨‹ç®€å•çš„ä»£ç </strong>â€ æå‡è¿è¡Œæ•ˆç‡ã€‚å‰”é™¤æ­»ä»£ç ï¼Œæ­»ä»£ç åŒ…æ‹¬ï¼šä¸å¯è¾¾ä»£ç ï¼›æ— ç”¨è®¡ç®—ï¼›å†—ä½™çš„ç±»å‹æ£€æŸ¥ã€‚</p>
<p>åœ¨åˆ†æä¼˜åŒ–é€»è¾‘ä¹‹å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹ feedback_vector ã€‚JS ä»£ç åœ¨V8å¼•æ“ä¸­è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„ä»£ç åˆ†æ &#x2F; è¿è¡Œè®°å½• ç­‰ä¿¡æ¯éƒ½æ˜¯è®°å½•åœ¨ feedback_vector ä¸Šã€‚</p>
<p><img data-src="/ron.github.io/images/v8/2411/image%205.png" alt="image.png"></p>
<p>åœ¨ <code>JS source â†’ bytecode -&gt; intercept execute - â€¦ â†’ Maglev â€¦ â†’ TurboFan â†’ MachineCode ..</code> è¿‡ç¨‹ä¸­ä»£ç çš„åˆ†æç»“æœï¼Œè¿è¡Œä¸­çš„è¿”å›å€¼ã€ç¨³å®šæ€§ã€è€—æ—¶ç­‰ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ feedback_vector ä¸Š.  </p>
<div class="note info no-icon"><p>ğŸ’¡<br>åˆ†ç±»ä»‹ç» feedback_vector å­˜å‚¨çš„é‡è¦ä¿¡æ¯</p>
<p>1ã€ä»£ç ç¼–è¯‘åˆ†æä¿¡æ¯ï¼š</p>
<p>2ã€è¿è¡Œæ—¶ä¼˜åŒ–ä¿¡æ¯</p>
</div>

<p> V8 åŸºäº å„ä¸ªç¯èŠ‚æå–çš„ feedback_vector ä¿¡æ¯è¿›è¡Œä¼˜åŒ–&#x2F;å»ä¼˜åŒ–åˆ†æã€‚åŒ…æ‹¬ï¼šæ­»ä»£ç æ¶ˆé™¤ã€IC å†…è”ä»£ç ä¼˜åŒ–ã€Hot æ ‡è®°ä¼˜åŒ–ã€‚</p>
<p>æ ‡è®°ä¼˜åŒ–çš„å¤§æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img data-src="/ron.github.io/images/v8/2411/image%206.png" alt="image.png"></p>
<h3 id="æ­»ä»£ç æ¶ˆé™¤"><a href="#æ­»ä»£ç æ¶ˆé™¤" class="headerlink" title="æ­»ä»£ç æ¶ˆé™¤"></a><strong>æ­»ä»£ç æ¶ˆé™¤</strong></h3><p>V8 å¯¹ä»£ç è¿›è¡Œæ ‡è®°ï¼Œä¸å¯è¾¾çš„ä»£ç ï¼›æ— ç”¨è®¡ç®—çš„ä»£ç ï¼›å†—ä½™çš„ç±»å‹æ£€æŸ¥ç­‰ç­‰ä»£ç ä¼šè¢«æ ‡è®°ä¸º isDeadã€‚è¿™äº›ä»£ç ä¸ä¼šè¢«æ‰§è¡Œä¹Ÿä¸ä¼šè¢«å†…è”ä¼˜åŒ–æ£€æŸ¥åˆ°ï¼</p>
<h3 id="å†…è”ä¼˜åŒ–-ã€src-compiler-js-inlining-heuristic-ccã€‘"><a href="#å†…è”ä¼˜åŒ–-ã€src-compiler-js-inlining-heuristic-ccã€‘" class="headerlink" title="å†…è”ä¼˜åŒ– ã€src&#x2F;compiler&#x2F;js-inlining-heuristic.ccã€‘"></a><strong>å†…è”ä¼˜åŒ– ã€src&#x2F;compiler&#x2F;js-inlining-heuristic.ccã€‘</strong></h3><p>å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€ï¼ˆè°ƒç”¨æ ˆåˆ‡æ¢ï¼‰ï¼›å‡å°‘å±€éƒ¨å˜é‡è®¿é—®æ¬¡æ•°æ¥æå‡å®ç°ä¼˜åŒ–ã€‚å‡½æ•°ä½“ç§¯å°ã€è°ƒç”¨é¢‘ç‡é«˜ã€å‚æ•°ç±»å‹ç¨³å®šã€æ²¡æœ‰å¤æ‚æ§åˆ¶æµã€‚ä¸€å¥è¯ï¼Œ<strong>é«˜é¢‘è°ƒç”¨ä¸”å¯é¢„æµ‹çš„å°å‡½æ•°ã€‚</strong></p>
<p>å†…è”ä¼˜åŒ–çš„å° case</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŸä»£ç </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">calc</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">add</span>(x, y) * <span class="number">2</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…è”ä¼˜åŒ–å</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">calc</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (x + y) * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†…è”ä¼˜åŒ–æ ‡è®°ç­–ç•¥ï¼š</p>
<div class="note info no-icon"><p>ğŸ’¡</p>
<ol>
<li>æ„é€ å‡½æ•°è°ƒç”¨æˆ–è€…æ™®é€šå‡½æ•°è°ƒç”¨</li>
<li>å­˜åœ¨ç›´æ¥é€’å½’è°ƒç”¨çš„ä¸ä¼˜åŒ–</li>
<li>æœªè¾¾åˆ°æœ€ä½è°ƒç”¨é¢‘ç‡ä¸ä¼˜åŒ–</li>
<li>å¼ºåˆ¶å†…è”å°å‡½æ•°ã€27å­—èŠ‚ç ä»¥å†…ï¼Œè½¬æ¢JSä»£ç å¤§æ¦‚1-2è¡Œã€‘æ³¨æ„ï¼šå³ä½¿æ˜¯å°å‡½æ•°ä¸ç¬¦åˆå‰ä¸‰æ¡ä¹Ÿä¸ä¼šä¼˜åŒ–ï¼</li>
<li>è€ƒè™‘å†…å­˜å’Œæ€§èƒ½é¢„ç®—ï¼Œå½“å†…å­˜é¢„ç®—åˆ°äº†ç“¶é¢ˆåœæ­¢å†…è”ï¼Œå†…å­˜å ç”¨è¶…è¿‡é¢„ç®—ç”šè‡³ä¼šå°†éƒ¨åˆ†å†…è”è¿›è¡Œé€€åŒ–ã€‚å°å‡½æ•°ä¼˜åŠ¿åœ¨æ­¤ï¼</li>
</ol>
</div>

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// file: src/compiler/js-inlining-heuristic.cc</span></span><br><span class="line"><span class="function">Reduction <span class="title">JSInliningHeuristic::Reduce</span><span class="params">(Node* node)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éæ„é€ å‡½æ•°è°ƒç”¨æˆ–è€…æ™®é€šå‡½æ•°è°ƒç”¨ é€€å‡ºæ£€æŸ¥</span></span><br><span class="line">  <span class="keyword">if</span> (!IrOpcode::<span class="built_in">IsInlineeOpcode</span>(node-&gt;<span class="built_in">opcode</span>())) <span class="keyword">return</span> <span class="built_in">NoChange</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç´¯è®¡å†…è”å¤§å°è¶…è¿‡ä¸Šé™--é€€å‡º</span></span><br><span class="line">  <span class="keyword">if</span> (total_inlined_bytecode_size_ &gt;= max_inlined_bytecode_size_absolute_) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">NoChange</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ...  </span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; candidate.num_functions; ++i) &#123;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">	  <span class="comment">// ç›´æ¥é€’å½’è°ƒç”¨---ä¸ä¼˜åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (frame_info.<span class="built_in">shared_info</span>().<span class="built_in">ToHandle</span>(&amp;frame_shared_info) &amp;&amp;</span><br><span class="line">        frame_shared_info.<span class="built_in">equals</span>(shared.<span class="built_in">object</span>())) &#123;</span><br><span class="line">      <span class="built_in">TRACE</span>(<span class="string">&quot;Not considering call site #&quot;</span> &lt;&lt; node-&gt;<span class="built_in">id</span>() &lt;&lt; <span class="string">&quot;:&quot;</span></span><br><span class="line">                                          &lt;&lt; node-&gt;<span class="built_in">op</span>()-&gt;<span class="built_in">mnemonic</span>()</span><br><span class="line">                                          &lt;&lt; <span class="string">&quot;, because of recursive inlining&quot;</span>);</span><br><span class="line">      candidate.can_inline_function[i] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">	 <span class="comment">// å¼ºåˆ¶ä¼˜åŒ–å°å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (candidate.can_inline_function[i]) &#123;</span><br><span class="line">      can_inline_candidate = <span class="literal">true</span>;</span><br><span class="line">      BytecodeArrayRef bytecode = candidate.bytecode[i].<span class="built_in">value</span>();</span><br><span class="line">      candidate.total_size += bytecode.<span class="built_in">length</span>();</span><br><span class="line">      <span class="type">unsigned</span> inlined_bytecode_size = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (OptionalJSFunctionRef function = candidate.functions[i]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (OptionalCodeRef code = function-&gt;<span class="built_in">code</span>(<span class="built_in">broker</span>())) &#123;</span><br><span class="line">          inlined_bytecode_size = code-&gt;<span class="built_in">GetInlinedBytecodeSize</span>();</span><br><span class="line">          candidate.total_size += inlined_bytecode_size;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      candidate_is_small = candidate_is_small &amp;&amp;</span><br><span class="line">                           <span class="built_in">IsSmall</span>(bytecode.<span class="built_in">length</span>() + inlined_bytecode_size);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (!can_inline_candidate) <span class="keyword">return</span> <span class="built_in">NoChange</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æœªè¾¾åˆ°æœ€ä½è°ƒç”¨é¢‘ç‡ä¸ä¼˜åŒ–ï¼šmin_inlining_frequency = 0.15</span></span><br><span class="line">  <span class="keyword">if</span> (candidate.frequency.<span class="built_in">IsKnown</span>() &amp;&amp;</span><br><span class="line">      candidate.frequency.<span class="built_in">value</span>() &lt; v8_flags.min_inlining_frequency) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">NoChange</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  seen_.<span class="built_in">insert</span>(node-&gt;<span class="built_in">id</span>());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°å‡½æ•°å¼ºåˆ¶å†…è”---</span></span><br><span class="line">  <span class="keyword">if</span> (candidate_is_small) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">InlineCandidate</span>(candidate, <span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// In the general case we remember the candidate for later.</span></span><br><span class="line">  candidates_.<span class="built_in">insert</span>(candidate);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">NoChange</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Returns true if opcode can be inlined.</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">IsInlineeOpcode</span><span class="params">(Value value)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value == kJSConstruct || value == kJSCall;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<div class="note info no-icon"><p>ğŸ’¡<br>opcode å¸¸è§å€¼å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>kJSCall</strong>ï¼šè¡¨ç¤ºä¸€ä¸ªæ™®é€šçš„ JavaScript å‡½æ•°è°ƒç”¨ã€‚</li>
<li><strong>kJSConstruct</strong>ï¼šè¡¨ç¤ºä¸€ä¸ªæ„é€ å‡½æ•°è°ƒç”¨ï¼Œé€šå¸¸æ˜¯é€šè¿‡Â <strong><code>new</code></strong>Â å…³é”®å­—è°ƒç”¨çš„å‡½æ•°ã€‚</li>
<li><strong>kJSReturn</strong>ï¼šè¡¨ç¤ºè¿”å›è¯­å¥ï¼Œç»“æŸå½“å‰å‡½æ•°å¹¶è¿”å›å€¼ã€‚</li>
<li><strong>kJSLoadProperty</strong>ï¼šè¡¨ç¤ºåŠ è½½å¯¹è±¡çš„å±æ€§ã€‚</li>
<li><strong>kJSStoreProperty</strong>ï¼šè¡¨ç¤ºå°†å€¼å­˜å‚¨åˆ°å¯¹è±¡çš„å±æ€§ä¸­ã€‚</li>
<li><strong>kJSLoadElement</strong>ï¼šè¡¨ç¤ºåŠ è½½æ•°ç»„æˆ–ç±»æ•°ç»„å¯¹è±¡çš„å…ƒç´ ã€‚</li>
<li><strong>kJSStoreElement</strong>ï¼šè¡¨ç¤ºå°†å€¼å­˜å‚¨åˆ°æ•°ç»„æˆ–ç±»æ•°ç»„å¯¹è±¡çš„å…ƒç´ ä¸­ã€‚</li>
<li><strong>kJSThrow</strong>ï¼šè¡¨ç¤ºæŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li><strong>kJSBranch</strong>ï¼šè¡¨ç¤ºæ¡ä»¶åˆ†æ”¯æˆ–è·³è½¬ã€‚</li>
</ol>
</div>

<p>æ ‡è®°å®Œæˆåï¼Œéœ€è¦è¿›è¡Œä¼˜åŒ–å‰æ£€æŸ¥ï¼Œæ’åºã€‚åˆ°è¿™é‡Œçš„åŸºæœ¬éƒ½æ˜¯éå°å‡½æ•°ã€å¤§æ¦‚æ˜¯å‡½æ•°ä½“è¶…è¿‡2è¡Œï¼Œå°å‡½æ•°å­—èŠ‚ç é™åˆ¶27å­—èŠ‚ã€‘ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// file: src/compiler/js-inlining-heuristic.cc</span></span><br><span class="line"><span class="comment">// æ’åºç­–ç•¥</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">JSInliningHeuristic::Finalize</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">  <span class="keyword">while</span> (!candidates_.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    <span class="keyword">auto</span> i = candidates_.<span class="built_in">begin</span>();</span><br><span class="line">    Candidate candidate = *i;</span><br><span class="line">    candidates_.<span class="built_in">erase</span>(i);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å·²ç»ä¼˜åŒ–äº†çš„--è·³è¿‡</span></span><br><span class="line">    <span class="keyword">if</span> (!IrOpcode::<span class="built_in">IsInlineeOpcode</span>(candidate.node-&gt;<span class="built_in">opcode</span>())) <span class="keyword">continue</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ— æ•ˆæ­»ä»£ç ï¼Œè·³è¿‡</span></span><br><span class="line">    <span class="keyword">if</span> (candidate.node-&gt;<span class="built_in">IsDead</span>()) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¢„ç®—æ£€æŸ¥---</span></span><br><span class="line">    <span class="type">double</span> size_of_candidate =</span><br><span class="line">        candidate.total_size * v8_flags.reserve_inline_budget_scale_factor;</span><br><span class="line">    <span class="type">int</span> total_size =</span><br><span class="line">        total_inlined_bytecode_size_ + <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(size_of_candidate);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¶…è¿‡å†…è”é¢„ç®—ä¸Šé™---æœ¬æ¬¡æš‚æ—¶ä¸ä¼˜åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (total_size &gt; max_inlined_bytecode_size_cumulative_) &#123;</span><br><span class="line">      info_-&gt;<span class="built_in">set_could_not_inline_all_candidates</span>();</span><br><span class="line">      <span class="comment">// Try if any smaller functions are available to inline.</span></span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ­å–œï¼ï¼è¿›å…¥ä¸‹ä¸€ç¯èŠ‚~ </span></span><br><span class="line">    Reduction <span class="type">const</span> reduction = <span class="built_in">InlineCandidate</span>(candidate, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (reduction.<span class="built_in">Changed</span>()) <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ†æå‡½æ•°å†å²æ‰§è¡Œæƒ…å†µï¼ä»å‚æ•°æ ¼å¼ç»“æ„ç¨³å®šæ€§ã€è¿è¡Œç»“æœç¨³å®šæ€§ã€å¼‚å¸¸é”™è¯¯ç­‰æ–¹é¢è¿›è¡Œè¯„ä¼°ï¼Œå†…å®¹æ¥è‡ª feedback_vectorã€‚</p>
<ul>
<li>ç¨³å®šæ€§æ£€æŸ¥ï¼Œå‡ºç°è¿‡ä¸ç¨³å®šæ‰§è¡Œçš„å‡½æ•°ä¸­æ­¢ä¼˜åŒ–ï¼</li>
<li>å‡½æ•°å†…é€æ­¥è¿›è¡Œå†…è”ä¼˜åŒ–ï¼ç›´åˆ°æ€»å†…è”ä¼˜åŒ–å ç”¨è¾¾åˆ°ä¸Šé™ï¼</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">Reduction <span class="title">JSInliningHeuristic::InlineCandidate</span><span class="params">(Candidate <span class="type">const</span>&amp; candidate,</span></span></span><br><span class="line"><span class="params"><span class="function">                                               <span class="type">bool</span> small_function)</span> </span>&#123;</span><br><span class="line">   ...                                            </span><br><span class="line">  <span class="comment">// æ£€æŸ¥è°ƒç”¨æ˜¯å¦ç¨³å®š--å‚æ•°æ£€æŸ¥ï¼</span></span><br><span class="line">  Node* if_exception = <span class="literal">nullptr</span>;</span><br><span class="line">  <span class="keyword">if</span> (NodeProperties::<span class="built_in">IsExceptionalCall</span>(node, &amp;if_exception)) &#123;</span><br><span class="line">    Node* if_exceptions[kMaxCallPolymorphism + <span class="number">1</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥å†å²æ‰§è¡Œæƒ…å†µï¼šè¿è¡Œç¨³å®šæ€§ã€å¼‚å¸¸ç»“æœæ£€æŸ¥</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_calls; ++i) &#123;</span><br><span class="line">      if_successes[i] = <span class="built_in">graph</span>()-&gt;<span class="built_in">NewNode</span>(<span class="built_in">common</span>()-&gt;<span class="built_in">IfSuccess</span>(), calls[i]);</span><br><span class="line">      if_exceptions[i] =</span><br><span class="line">          <span class="built_in">graph</span>()-&gt;<span class="built_in">NewNode</span>(<span class="built_in">common</span>()-&gt;<span class="built_in">IfException</span>(), calls[i], calls[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Morph the &#123;if_exception&#125; projection into a join.</span></span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¨³å®šæ€§æ£€æŸ¥é€šè¿‡åï¼Œé€æ­¥è¿›è¡Œå†…è”ä¼˜åŒ–ï¼ç›´åˆ°æ€»å†…è”ä¼˜åŒ–å ç”¨è¾¾åˆ°ä¸Šé™ï¼</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_calls &amp;&amp; total_inlined_bytecode_size_ &lt;</span><br><span class="line">                                       max_inlined_bytecode_size_absolute_;</span><br><span class="line">       ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (candidate.can_inline_function[i] &amp;&amp;</span><br><span class="line">        (small_function || total_inlined_bytecode_size_ &lt;</span><br><span class="line">                               max_inlined_bytecode_size_cumulative_)) &#123;</span><br><span class="line">      Node* call = calls[i];</span><br><span class="line">      Reduction <span class="type">const</span> reduction = inliner_.<span class="built_in">ReduceJSCall</span>(call);</span><br><span class="line">      <span class="keyword">if</span> (reduction.<span class="built_in">Changed</span>()) &#123;</span><br><span class="line">        total_inlined_bytecode_size_ += candidate.bytecode[i]-&gt;<span class="built_in">length</span>();</span><br><span class="line">        call-&gt;<span class="built_in">Kill</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Replace</span>(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å†…è”ä¼˜åŒ–å­˜åœ¨å‡ ä¸ªé’ˆå¯¹å­—èŠ‚ç å¤§å°çš„é™åˆ¶ï¼Œ</p>
<div class="note info no-icon"><p>ğŸ’¡</p>
<ul>
<li>å°å‡½æ•°å†…è”å¤§å°ï¼š27å­—èŠ‚</li>
<li>å•ä¸ªå†…è”æœ€å¤§å­—èŠ‚ç ï¼š460å­—èŠ‚</li>
<li>ç´¯è®¡å†…è”ä¸Šé™ï¼š920å­—èŠ‚</li>
</ul>
</div>

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// file : src/flags/flag-definitions.h</span></span><br><span class="line"><span class="built_in">DEFINE_INT</span>(max_inlined_bytecode_size, <span class="number">460</span>,</span><br><span class="line">           <span class="string">&quot;maximum size of bytecode for a single inlining&quot;</span>)</span><br><span class="line"><span class="built_in">DEFINE_INT</span>(max_inlined_bytecode_size_cumulative, <span class="number">920</span>,</span><br><span class="line">           <span class="string">&quot;maximum cumulative size of bytecode considered for inlining&quot;</span>)</span><br><span class="line"><span class="built_in">DEFINE_INT</span>(max_inlined_bytecode_size_absolute, <span class="number">4600</span>,</span><br><span class="line">           <span class="string">&quot;maximum absolute size of bytecode considered for inlining&quot;</span>)</span><br><span class="line"><span class="built_in">DEFINE_FLOAT</span>(</span><br><span class="line">    reserve_inline_budget_scale_factor, <span class="number">1.2</span>,</span><br><span class="line">    <span class="string">&quot;scale factor of bytecode size used to calculate the inlining budget&quot;</span>)</span><br><span class="line"><span class="built_in">DEFINE_INT</span>(max_inlined_bytecode_size_small, <span class="number">27</span>,</span><br><span class="line">           <span class="string">&quot;maximum size of bytecode considered for small function inlining&quot;</span>)</span><br><span class="line"><span class="built_in">DEFINE_INT</span>(max_optimized_bytecode_size, <span class="number">60</span> * KB,</span><br><span class="line">           <span class="string">&quot;maximum bytecode size to &quot;</span></span><br><span class="line">           <span class="string">&quot;be considered for turbofan optimization; too high values may cause &quot;</span></span><br><span class="line">           <span class="string">&quot;the compiler to hit (release) assertions&quot;</span>)</span><br><span class="line"><span class="built_in">DEFINE_FLOAT</span>(min_inlining_frequency, <span class="number">0.15</span>, <span class="string">&quot;minimum frequency for inlining&quot;</span>)</span><br><span class="line"><span class="built_in">DEFINE_BOOL</span>(polymorphic_inlining, <span class="literal">true</span>, <span class="string">&quot;polymorphic inlining&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–ä¸ä¼šè¢«ä¼˜åŒ–çš„åœºæ™¯ï¼š</p>
<div class="note info no-icon"><p>ğŸ’¡</p>
<ul>
<li>åŠ¨æ€çš„ eval</li>
<li>with è¯­å¥</li>
<li>å¤æ‚çš„ try catch</li>
<li>å•ä¸ªå‡½æ•°ç¼–è¯‘ä¸ºå­—èŠ‚ç å†…å­˜è¶…è¿‡ 460 å­—èŠ‚</li>
<li>è°ƒç”¨è¯„ç‡ä½ï¼šignition ä¸º 0.15 [å•ä½æ²¡çœ‹æ‡‚]</li>
<li>åŠ¨æ€ import</li>
<li>éçº¯å‡½æ•°ï¼Œå­˜åœ¨ä¸å¯é¢„æµ‹çš„è¿‡ç¨‹</li>
</ul>
</div>

<p>å†…è”ä¼˜åŒ–æ˜¯é€šè¿‡å¯¹è§£é‡Šæ‰§è¡Œçš„å­—èŠ‚ç è¿›è¡Œæ‰§è¡Œè¿‡ç¨‹ä¸­åˆ†æè½¬æ¢çš„ï¼Œ<strong>å†…è”ä¼˜åŒ–åäº§ç‰©è¿˜æ˜¯å­—èŠ‚ç ï¼ŒHot ä»£ç ä¸­å†…è”ä¼˜åŒ–çš„ä»£ç åˆ™ä¼šä¸€åŒç¼–è¯‘æˆæœºå™¨ç </strong>ã€‚Hot ä»£ç ç¼–è¯‘æœºå™¨ç éƒ¨åˆ†ï¼Œä¸å†è¿½æº¯å…³äºå†…è”ä¼˜åŒ–ç›¸å…³å†…å®¹ã€‚</p>
<h3 id="Hot-ä»£ç ä¼˜åŒ–"><a href="#Hot-ä»£ç ä¼˜åŒ–" class="headerlink" title="Hot ä»£ç ä¼˜åŒ–"></a>Hot ä»£ç ä¼˜åŒ–</h3><p>V8 ä»£ç åœ¨å­—èŠ‚ç è§£é‡Šæ‰§è¡Œé˜¶æ®µä¼šé™„å¸¦æ ‡è®°Hotä»£ç ï¼ˆé™„å¸¦ä¿¡æ¯å­˜äºfeedback_vectorï¼‰ï¼Œé€šè¿‡å°† Hot ä»£ç ä»å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç ã€‚æœºå™¨ç ç”±CPUç›´æ¥è¿è¡Œæ•ˆç‡è¿œè¿œå¤§äºignitionè§£é‡Šå™¨è¿è¡Œå­—èŠ‚ç ã€‚</p>
<p>V8 å¼•æ“é‡‡ç”¨å¤šçº§ä¼˜åŒ–ç­–ç•¥ï¼ˆå¹³è¡¡ç¼–è¯‘è€—æ—¶å’Œæœºå™¨ç ä¼˜åŒ–æ·±åº¦ï¼‰ï¼Œæˆªæ­¢24å¹´11æœˆï¼ŒV8å‘å¸ƒæºç ä¸­é‡‡ç”¨çš„æ˜¯ä¸‰çº§ç¼–è¯‘å™¨ã€‚ Maglev ç¼–è¯‘å™¨ç¬¬ä¸€ç‰ˆæœ¬å‘å¸ƒæ˜¯åœ¨ chrome 117 ã€‚</p>
<p>å…ˆä»‹ç»ä¸€ä¸‹Hotä»£ç æ¶‰åŠçš„ä¼˜åŒ–ç¼–è¯‘å™¨ï¼š</p>
<p><img data-src="/ron.github.io/images/v8/2411/image%207.png" alt="image.png"></p>
<p>ä¸‰çº§ä¼˜åŒ–æ¨¡å‹ï¼ŒV8ç›®çš„æ˜¯å¹³è¡¡ç¼–è¯‘æˆæœ¬å’Œè¿è¡Œé€Ÿåº¦ã€‚ç¼–è¯‘æˆæœ¬ï¼šç¼–è¯‘æ—¶é—´ + å†…å­˜å ç”¨ã€‚ç¼–è¯‘é€Ÿåº¦Sparkplugæœ€å¿«ã€‚ä»¥ä¸‹æ˜¯ç¼–è¯‘çš„é€Ÿåº¦ï¼š</p>
<p><img data-src="/ron.github.io/images/v8/2411/image%208.png" alt="image.png"></p>
<p>V8 å¼•æ“è§£é‡Šå™¨+ç¼–è¯‘å™¨ä¼˜åŒ–å†å²ç»„åˆè·‘åˆ†æƒ…å†µï¼š</p>
<p><img data-src="/ron.github.io/images/v8/2411/image%209.png" alt="image.png"></p>
<div class="note info no-icon"><p>ğŸ’¡</p>
<h3 id="1-Ignitionï¼ˆè§£é‡Šå™¨ï¼‰"><a href="#1-Ignitionï¼ˆè§£é‡Šå™¨ï¼‰" class="headerlink" title="1. Ignitionï¼ˆè§£é‡Šå™¨ï¼‰"></a>1. <strong>Ignition</strong>ï¼ˆè§£é‡Šå™¨ï¼‰</h3><ul>
<li><strong>é˜¶æ®µ</strong>ï¼šIgnition æ˜¯ V8 çš„å­—èŠ‚ç è§£é‡Šå™¨ï¼Œå®ƒæ˜¯ JavaScript æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚</li>
<li><strong>åŠŸèƒ½</strong>ï¼šå°† JavaScript æºä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œå¹¶é€æ¡è§£é‡Šæ‰§è¡Œã€‚è¿™ç§è§£é‡Šæ‰§è¡Œé€šå¸¸é€‚åˆåˆå§‹åŒ–é˜¶æ®µæˆ–çŸ­æœŸã€ä½é¢‘æ‰§è¡Œçš„ä»£ç ã€‚</li>
<li><strong>è°ƒç”¨æ¡ä»¶</strong>ï¼šä»£ç é¦–æ¬¡åŠ è½½æ—¶ï¼ŒIgnition ä¼šå°†æºä»£ç è½¬ä¸ºå­—èŠ‚ç ï¼Œç„¶åè§£é‡Šæ‰§è¡Œã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šè§£é‡Šå™¨ç”Ÿæˆå­—èŠ‚ç çš„é€Ÿåº¦è¾ƒå¿«ã€å†…å­˜å¼€é”€å°ï¼Œä½†ç”±äºæ¯æ¬¡éƒ½éœ€è¦è§£é‡Šï¼Œæ€§èƒ½ä¼šæ¯”ç¼–è¯‘çš„æœºå™¨ç ç¨æ…¢ã€‚</li>
</ul>
<h3 id="2-Sparkplugï¼ˆåŸºçº¿ç¼–è¯‘å™¨ï¼‰"><a href="#2-Sparkplugï¼ˆåŸºçº¿ç¼–è¯‘å™¨ï¼‰" class="headerlink" title="2. Sparkplugï¼ˆåŸºçº¿ç¼–è¯‘å™¨ï¼‰"></a>2. <strong>Sparkplug</strong>ï¼ˆåŸºçº¿ç¼–è¯‘å™¨ï¼‰</h3><ul>
<li><strong>é˜¶æ®µ</strong>ï¼šåœ¨ Ignition ä¹‹åï¼Œä½œä¸ºå¿«é€Ÿç¼–è¯‘é˜¶æ®µæ‰§è¡Œã€‚</li>
<li><strong>åŠŸèƒ½</strong>ï¼šSparkplug æ˜¯ V8 çš„åŸºçº¿ç¼–è¯‘å™¨ï¼Œè´Ÿè´£å°†å­—èŠ‚ç å¿«é€Ÿç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œæ¥æé«˜ä»£ç æ‰§è¡Œé€Ÿåº¦ã€‚ç›¸æ¯”è§£é‡Šæ‰§è¡Œï¼Œç¼–è¯‘åçš„ä»£ç è¿è¡Œæ›´å¿«ï¼Œä½† Sparkplug å¹¶ä¸ä¼šè¿›è¡Œå¤æ‚ä¼˜åŒ–ï¼Œå› æ­¤ç¼–è¯‘æ—¶é—´ä¹Ÿéå¸¸çŸ­ã€‚</li>
<li><strong>è°ƒç”¨æ¡ä»¶</strong>ï¼šå½“ä»£ç è¢«æ ‡è®°ä¸ºâ€œçƒ­â€ä»£ç ; ä¸å­˜åœ¨ feedback_vector;</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå¿«é€Ÿç”Ÿæˆæœºå™¨ç ï¼Œæå‡ä»£ç æ€§èƒ½çš„åŒæ—¶ä»ä¿æŒè¾ƒä½å†…å­˜æ¶ˆè€—ã€‚</li>
</ul>
<h3 id="3-Maglevï¼ˆä¸­å±‚ç¼–è¯‘å™¨ï¼‰"><a href="#3-Maglevï¼ˆä¸­å±‚ç¼–è¯‘å™¨ï¼‰" class="headerlink" title="3. Maglevï¼ˆä¸­å±‚ç¼–è¯‘å™¨ï¼‰"></a>3. <strong>Maglev</strong>ï¼ˆä¸­å±‚ç¼–è¯‘å™¨ï¼‰</h3><ul>
<li><strong>é˜¶æ®µ</strong>ï¼šä½äº Sparkplug å’Œ TurboFan ä¹‹é—´ã€‚</li>
<li><strong>åŠŸèƒ½</strong>ï¼šMaglev æ˜¯ä¸€ç§ä¸­å±‚å³æ—¶ç¼–è¯‘å™¨ï¼Œç”¨äºåœ¨ä»£ç â€œçƒ­åº¦â€å¢åŠ ä½†å°šæœªè¿›å…¥æ·±åº¦ä¼˜åŒ–é˜¶æ®µæ—¶æä¾›è¿›ä¸€æ­¥çš„ä¼˜åŒ–ã€‚Maglev ç”Ÿæˆçš„æœºå™¨ç è´¨é‡é«˜äº Sparkplugï¼Œä½†æ²¡æœ‰ TurboFan çš„å¤æ‚ä¼˜åŒ–ã€‚</li>
<li><strong>è°ƒç”¨æ¡ä»¶</strong>ï¼šSparkplug ä¼˜åŒ–ä»£ç æ‰§è¡Œä¼˜åŒ–åï¼Œä»£ç ç±»å‹å…è®¸å‡çº§åˆ° Maglevï¼›ä¹‹å‰æ²¡æœ‰Maglev ç¼–è¯‘å¤±è´¥è®°å½•ï¼›æœªå¯åŠ¨PGO(Profile Guided Optimization),å¯åŠ¨PGOçš„ç›´å¥”TurboFanï¼›</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæä¾›æ›´é«˜è´¨é‡çš„æœºå™¨ç ï¼Œåœ¨æé«˜æ€§èƒ½çš„åŒæ—¶é¿å…è¿‡å¤šè°ƒç”¨ TurboFanã€‚</li>
</ul>
<h3 id="4-TurboFanï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰"><a href="#4-TurboFanï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰" class="headerlink" title="4. TurboFanï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰"></a>4. <strong>TurboFan</strong>ï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰</h3><ul>
<li><strong>é˜¶æ®µ</strong>ï¼šåœ¨ä»£ç è¢«é¢‘ç¹è°ƒç”¨åï¼Œä¸ºæ€§èƒ½çš„æœ€åæå‡æ‰§è¡Œã€‚</li>
<li><strong>åŠŸèƒ½</strong>ï¼šTurboFan æ˜¯ V8 çš„ä¼˜åŒ–ç¼–è¯‘å™¨ï¼Œå¯¹ä»£ç è¿›è¡Œæ·±åº¦ä¼˜åŒ–ï¼Œç”Ÿæˆé«˜åº¦ä¼˜åŒ–çš„æœºå™¨ç ã€‚å®ƒé€‚åˆæ‰§è¡Œé¢‘ç‡éå¸¸é«˜ã€é•¿æ—¶é—´è¿è¡Œçš„â€œçƒ­â€ä»£ç ã€‚</li>
<li><strong>è°ƒç”¨æ¡ä»¶</strong>ï¼šä»£ç æ‰§è¡Œé¢‘ç‡æé«˜æ—¶è§¦å‘ï¼Œç‰¹åˆ«æ˜¯åœ¨ Maglev ç”Ÿæˆçš„ä»£ç ä»ä¸å¤Ÿé«˜æ•ˆçš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šè¿›å…¥ TurboFan çš„æ·±åº¦ä¼˜åŒ–é˜¶æ®µã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šTurboFan ä¼šè§‚å¯Ÿä»£ç çš„æ‰§è¡Œæ¨¡å¼ï¼Œé€šè¿‡å†…è”ç¼“å­˜å’Œéšè—ç±»ç­‰ä¿¡æ¯ï¼Œå¯¹ä»£ç è¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œä½¿å…¶è¾¾åˆ°æœ€ä½³æ€§èƒ½ã€‚</li>
</ul>
</div>

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// file: src/execution/tiering-manager.cc</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TieringManager::OnInterruptTick</span><span class="params">(DirectHandle&lt;JSFunction&gt; function,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     CodeKind code_kind)</span> </span>&#123;</span><br><span class="line">	... </span><br><span class="line">  <span class="comment">// ç¬¬ä¸€æ­¥ï¼šå…ˆæ£€æŸ¥æ˜¯å¦å¯ä½¿ç”¨ Sparkplug ä¼˜åŒ–ï¼šã€å‡½æ•°æ²¡æœ‰feedback_vectorã€‘</span></span><br><span class="line">  <span class="type">const</span> <span class="type">bool</span> compile_sparkplug =</span><br><span class="line">      <span class="built_in">CanCompileWithBaseline</span>(isolate_, function-&gt;<span class="built_in">shared</span>()) &amp;&amp;</span><br><span class="line">      function-&gt;<span class="built_in">ActiveTierIsIgnition</span>(isolate_) &amp;&amp; !maybe_had_optimized_osr_code;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (compile_sparkplug) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> V8_ENABLE_SPARKPLUG</span></span><br><span class="line">    <span class="comment">// sparkpug å…¥å£ã€‚ã€‚ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (v8_flags.baseline_batch_compilation) &#123;</span><br><span class="line">      isolate_-&gt;<span class="built_in">baseline_batch_compiler</span>()-&gt;<span class="built_in">EnqueueFunction</span>(function);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// </span></span><br><span class="line">  <span class="keyword">if</span> (first_time_tiered_up_to_sparkplug) &#123;</span><br><span class="line">    <span class="keyword">if</span> (had_feedback_vector) &#123;</span><br><span class="line">      <span class="keyword">if</span> (function-&gt;<span class="built_in">shared</span>()-&gt;<span class="built_in">cached_tiering_decision</span>() ==</span><br><span class="line">          CachedTieringDecision::kPending) &#123;</span><br><span class="line">        function-&gt;<span class="built_in">shared</span>()-&gt;<span class="built_in">set_cached_tiering_decision</span>(</span><br><span class="line">            CachedTieringDecision::kEarlySparkplug);</span><br><span class="line">      &#125;</span><br><span class="line">      function-&gt;<span class="built_in">SetInterruptBudget</span>(isolate_);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Sparkplug ä¼˜åŒ–åå‡çº§çš„åœºæ™¯ï¼šMaglevã€turboFan</span></span><br><span class="line">  <span class="built_in">MaybeOptimizeFrame</span>(function_obj, code_kind);</span><br><span class="line"></span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TieringManager::MaybeOptimizeFrame</span><span class="params">(Tagged&lt;JSFunction&gt; function,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        CodeKind current_code_kind)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">... </span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">V8_UNLIKELY</span>(v8_flags.always_osr)) &#123;</span><br><span class="line">    <span class="built_in">TryRequestOsrAtNextOpportunity</span>(isolate_, function);</span><br><span class="line">    <span class="comment">// Continue below and do a normal optimized compile as well.</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> <span class="type">bool</span> maglev_osr = maglev::<span class="built_in">IsMaglevOsrEnabled</span>();</span><br><span class="line">  <span class="type">const</span> CodeKinds available_kinds = function-&gt;<span class="built_in">GetAvailableCodeKinds</span>(isolate_);</span><br><span class="line">  </span><br><span class="line">  <span class="type">const</span> <span class="type">bool</span> waiting_for_tierup =</span><br><span class="line">      (current_code_kind &lt; CodeKind::TURBOFAN_JS &amp;&amp;</span><br><span class="line">       (available_kinds &amp; CodeKindFlag::TURBOFAN_JS)) ||</span><br><span class="line">      (maglev_osr &amp;&amp; current_code_kind &lt; CodeKind::MAGLEV &amp;&amp;</span><br><span class="line">       (available_kinds &amp; CodeKindFlag::MAGLEV));</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (function-&gt;<span class="built_in">IsOptimizationRequested</span>(isolate_) || waiting_for_tierup) &#123;</span><br><span class="line">    <span class="comment">// èŠ‚èƒ½æ¨¡å¼æˆ–ç”µæ± èŠ‚çœæ¨¡å¼ --- ä¸ä¼˜åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">V8_UNLIKELY</span>(maglev_osr &amp;&amp; current_code_kind == CodeKind::MAGLEV &amp;&amp;</span><br><span class="line">                    (!v8_flags.osr_from_maglev ||</span><br><span class="line">                     isolate_-&gt;<span class="built_in">EfficiencyModeEnabledForTiering</span>() ||</span><br><span class="line">                     isolate_-&gt;<span class="built_in">BatterySaverModeEnabled</span>()))) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// OSR kicks in only once we&#x27;ve previously decided to tier up, but we are</span></span><br><span class="line">    <span class="comment">// still in a lower-tier frame (this implies a long-running loop).</span></span><br><span class="line">    <span class="comment">// éœ€è¦ä¼˜åŒ–ï¼šä½†æ˜¯ä¼˜å…ˆçº§ä¸å¤Ÿçš„ï¼Œæä¾›ä¼˜åŒ–ï¼šå¤§å¾ªç¯</span></span><br><span class="line">    <span class="built_in">TryIncrementOsrUrgency</span>(isolate_, function);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  OptimizationDecision d =</span><br><span class="line">      <span class="built_in">ShouldOptimize</span>(function-&gt;<span class="built_in">feedback_vector</span>(), current_code_kind);</span><br><span class="line">      </span><br><span class="line">  <span class="comment">// We might be stuck in a baseline frame that wants to tier up to Maglev, but</span></span><br><span class="line">  <span class="comment">// is in a loop, and can&#x27;t OSR, because Maglev doesn&#x27;t have OSR. Allow it to</span></span><br><span class="line">  <span class="comment">// skip over Maglev by re-checking ShouldOptimize as if we were in Maglev.</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">V8_UNLIKELY</span>(!isolate_-&gt;<span class="built_in">EfficiencyModeEnabledForTiering</span>() &amp;&amp; !maglev_osr &amp;&amp;</span><br><span class="line">                  d.<span class="built_in">should_optimize</span>() &amp;&amp; d.code_kind == CodeKind::MAGLEV)) &#123;</span><br><span class="line">    <span class="type">bool</span> is_marked_for_maglev_optimization =</span><br><span class="line">        existing_request == CodeKind::MAGLEV ||</span><br><span class="line">        (available_kinds &amp; CodeKindFlag::MAGLEV);</span><br><span class="line">    <span class="comment">// ä¼˜åŒ–ç¬¬äºŒçº§ï¼šMaglev ä¼˜åŒ–æ£€æŸ¥è¿›å…¥</span></span><br><span class="line">    <span class="keyword">if</span> (is_marked_for_maglev_optimization) &#123;</span><br><span class="line">      d = <span class="built_in">ShouldOptimize</span>(function-&gt;<span class="built_in">feedback_vector</span>(), CodeKind::MAGLEV);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¿›å…¥ç»ˆæä¼˜åŒ–ï¼š turboFan</span></span><br><span class="line">  <span class="keyword">if</span> (d.<span class="built_in">should_optimize</span>()) <span class="built_in">Optimize</span>(function, d);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//-------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function">OptimizationDecision <span class="title">TieringManager::ShouldOptimize</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    Tagged&lt;FeedbackVector&gt; feedback_vector, CodeKind current_code_kind)</span> </span>&#123;</span><br><span class="line">  Tagged&lt;SharedFunctionInfo&gt; shared = feedback_vector-&gt;<span class="built_in">shared_function_info</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// å·²ç»ä¼˜åŒ–è¿‡çš„ä»£ç ï¼Œä¸å¤„ç†</span></span><br><span class="line">  <span class="keyword">if</span> (current_code_kind == CodeKind::TURBOFAN_JS) &#123;</span><br><span class="line">    <span class="keyword">return</span> OptimizationDecision::<span class="built_in">DoNotOptimize</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">TiersUpToMaglev</span>(current_code_kind) &amp;&amp;</span><br><span class="line">      shared-&gt;<span class="built_in">PassesFilter</span>(v8_flags.maglev_filter) &amp;&amp;</span><br><span class="line">      !shared-&gt;<span class="built_in">maglev_compilation_failed</span>()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (v8_flags.profile_guided_optimization &amp;&amp;</span><br><span class="line">        shared-&gt;<span class="built_in">cached_tiering_decision</span>() ==</span><br><span class="line">            CachedTieringDecision::kEarlyTurbofan) &#123;</span><br><span class="line">      <span class="comment">// è¿›å…¥TurboFan ä¼˜åŒ–</span></span><br><span class="line">      <span class="keyword">return</span> OptimizationDecision::<span class="built_in">TurbofanHotAndStable</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Maglev ä¼˜åŒ–</span></span><br><span class="line">    <span class="keyword">return</span> OptimizationDecision::<span class="built_in">Maglev</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">V8_UNLIKELY</span>(!v8_flags.turbofan ||</span><br><span class="line">                  !shared-&gt;<span class="built_in">PassesFilter</span>(v8_flags.turbo_filter) ||</span><br><span class="line">                  (v8_flags.efficiency_mode_disable_turbofan &amp;&amp;</span><br><span class="line">                   isolate_-&gt;<span class="built_in">EfficiencyModeEnabledForTiering</span>()) ||</span><br><span class="line">                  isolate_-&gt;<span class="built_in">BatterySaverModeEnabled</span>())) &#123;</span><br><span class="line">    <span class="keyword">return</span> OptimizationDecision::<span class="built_in">DoNotOptimize</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// invocation_count å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°ï¼ï¼efficiency_mode_delay_turbofan åˆå§‹å€¼15000</span></span><br><span class="line">  <span class="keyword">if</span> (isolate_-&gt;<span class="built_in">EfficiencyModeEnabledForTiering</span>() &amp;&amp;</span><br><span class="line">      v8_flags.efficiency_mode_delay_turbofan &amp;&amp;</span><br><span class="line">      feedback_vector-&gt;<span class="built_in">invocation_count</span>() &lt;</span><br><span class="line">          v8_flags.efficiency_mode_delay_turbofan) &#123;</span><br><span class="line">    <span class="keyword">return</span> OptimizationDecision::<span class="built_in">DoNotOptimize</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¼˜åŒ–çš„å­—èŠ‚ç è¶…è¿‡ä¸Šé™ï¼šä¸ä¼˜åŒ– max_optimized_bytecode_size åˆå§‹å€¼60KB</span></span><br><span class="line">  Tagged&lt;BytecodeArray&gt; bytecode = shared-&gt;<span class="built_in">GetBytecodeArray</span>(isolate_);</span><br><span class="line">  <span class="keyword">if</span> (bytecode-&gt;<span class="built_in">length</span>() &gt; v8_flags.max_optimized_bytecode_size) &#123;</span><br><span class="line">    <span class="keyword">return</span> OptimizationDecision::<span class="built_in">DoNotOptimize</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¿›å…¥ TurboFan ä¼˜åŒ– </span></span><br><span class="line">	<span class="keyword">return</span> OptimizationDecision::<span class="built_in">TurbofanHotAndStable</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå°±æ˜¯Hotä»£ç åˆ†å±‚ä¼˜åŒ–çš„å†…å®¹ï¼Œä»€ä¹ˆæ—¶å€™å»ä¼˜åŒ–å‘¢ï¼Ÿå½“å†…å­˜èµ„æºå‡ºç°å‹åŠ›åã€å‡½æ•°å˜å†·ï¼ˆè°ƒç”¨ä¸å†é¢‘ç¹ï¼‰ç­‰æƒ…å†µä¼˜åŒ–ä¼šè¢«å»æ‰ï¼Œé€€å›å­—èŠ‚ç è§£é‡Šæ‰§è¡Œã€‚</p>
<h2 id="å¦‚ä½•å†™å¥½ä»£ç ï¼Ÿ"><a href="#å¦‚ä½•å†™å¥½ä»£ç ï¼Ÿ" class="headerlink" title="å¦‚ä½•å†™å¥½ä»£ç ï¼Ÿ"></a>å¦‚ä½•å†™å¥½ä»£ç ï¼Ÿ</h2><p>æ€è€ƒé¢˜~</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><div class="note info no-icon"><p>ğŸ’¡</p>
<ul>
<li><a href="https://v8.dev/blog/maglev">Maglev - V8æœ€å¿«çš„JITä¼˜åŒ–</a>  <a href="https://v8.dev/blog/maglev">https://v8.dev/blog/maglev</a></li>
<li><a href="https://cabulous.medium.com/how-v8-javascript-engine-works-5393832d80a7">how-v8-javascript-engine-works</a> <a href="https://cabulous.medium.com/how-v8-javascript-engine-works-5393832d80a7">https://cabulous.medium.com/how-v8-javascript-engine-works-5393832d80a7</a></li>
<li><a href="https://www.youtube.com/watch?v=p-iiEDtpy6I">Franziska Hinkelmann: JavaScript engines - how do they even? | JSConf EU</a> <a href="https://www.youtube.com/watch?v=p-iiEDtpy6I">https://www.youtube.com/watch?v=p-iiEDtpy6I</a></li>
<li>V8 <a href="https://github.com/v8/v8">github.com&#x2F;v8</a></li>
</ul>
</div>]]></content>
      <tags>
        <tag>V8</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºå¼‚æ­¥æ“ä½œå¯¹è±¡æä¾›å¯å–æ¶ˆæ“ä½œ</title>
    <url>/ron.github.io/2024/10/29/%E4%B8%BA%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C%E5%AF%B9%E8%B1%A1%E6%8F%90%E4%BE%9B%E5%8F%AF%E5%8F%96%E6%B6%88%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h2 id="å¼‚æ­¥æ“ä½œå¯¹è±¡åº”è¯¥æä¾›å¯å–æ¶ˆæ“ä½œ"><a href="#å¼‚æ­¥æ“ä½œå¯¹è±¡åº”è¯¥æä¾›å¯å–æ¶ˆæ“ä½œ" class="headerlink" title="å¼‚æ­¥æ“ä½œå¯¹è±¡åº”è¯¥æä¾›å¯å–æ¶ˆæ“ä½œ"></a>å¼‚æ­¥æ“ä½œå¯¹è±¡åº”è¯¥æä¾›å¯å–æ¶ˆæ“ä½œ</h2><p>å¯¹äºå¼‚æ­¥æ“ä½œå¦‚ï¼šå¼‚æ­¥è®¡ç®—ã€ç½‘ç»œè¯·æ±‚ã€å®šæ—¶å™¨ç­‰æ“ä½œã€‚åœ¨æ¡ä»¶å˜æ›´ä»¥åï¼Œéœ€è¦å°†ä¸Šä¸€æ¬¡å˜æ›´è§¦å‘çš„å¼‚æ­¥æ“ä½œä¸­æ–­æŠ›å¼ƒã€é‡æ–°è§¦å‘æ–°çš„å¼‚æ­¥æ“ä½œã€‚æœªå–æ¶ˆå¤±æ•ˆçš„å¼‚æ­¥æ“ä½œå¯èƒ½å¯¼è‡´å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>æ•°æ®è¯·æ±‚&#x2F;å‚æ•°å˜æ›´ï¼Œæ•°æ®è¢«é”™è¯¯è¦†ç›–ã€‚ç¬¬äºŒä¸ªè¯·æ±‚è¿”å›åï¼Œä¸Šä¸€æ¬¡è¯·æ±‚è¿Ÿè¿Ÿè¿”å›å°†æ•°æ®è¦†ç›–ä¸ºæ—§æ•°æ®ã€‚</li>
<li>æœªå–æ¶ˆçš„å¼‚æ­¥æ“ä½œï¼Œå¼•å‘åç»­ç›‘å¬çš„å¤„ç†å‡½æ•°æ‰§è¡Œã€‚Promise ç›‘å¬çš„ resolveã€‚å½“ç„¶ reject ä¸­ä¹Ÿåº”è¯¥è€ƒè™‘åˆ°Promise æ“ä½œè¢«å–æ¶ˆå¼‚å¸¸ã€‚</li>
</ul>
<h2 id="AbortController-ä¸-AbortSignal-API"><a href="#AbortController-ä¸-AbortSignal-API" class="headerlink" title="AbortController ä¸ AbortSignal API"></a>AbortController ä¸ AbortSignal API</h2><p>AbortController ç”¨äºæ§åˆ¶ AbortSignal ï¼ŒAbortSignal æ˜¯å¯å–æ¶ˆçš„ä¿¡å·å¯¹è±¡ã€‚<br>AbortSignal å¯¹è±¡ä¸å¯ä»¥ç›´æ¥å®ä¾‹åŒ–ï¼Œä½†æä¾›äº†ä¸¤ä¸ªé™æ€APIæ–¹æ³•è¿”å› AbortSignal å®ä¾‹ã€AbortSignal.abort() è¿”å›ä¸€ä¸ªç»ˆæ­¢çš„çš„AbortSignal å®ä¾‹ï¼› AbortSignal.timeout(tims) è¿”å›ä¸€ä¸ªè‡ªåŠ¨ç»ˆæ­¢çš„AbortSignal å®ä¾‹; ã€‘ã€‚ AbortController å†…éƒ¨åœ¨æ„é€ å‡½æ•°ä¸­å®ä¾‹åŒ–ä¸€ä¸ª AbortSignal å¯¹è±¡, å¹¶æ”¯æŒ abort å‡½æ•°apiæ§åˆ¶æ˜¯å¦ç»ˆæ­¢ã€‚</p>
<p>å–æ¶ˆfetchè¯·æ±‚å°è£…<br>å½“è¿ç»­è§¦å‘è¯·æ±‚ï¼Œå‚æ•°å˜æ›´ç­‰åŸå› ä¸‹ã€‚å°†ä¸Šä¸€æ¬¡çš„è¿‡æœŸè¯·æ±‚å–æ¶ˆæ‰ï¼ˆæŸ¥è¯¢å‚æ•°å·²ç»å˜æ›´ï¼Œåªç­‰å¾…æœ€æ–°çš„è¯·æ±‚ï¼‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HasSignalFetch</span> &#123;</span><br><span class="line">    private <span class="attr">signal</span>: <span class="title class_">AbortController</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">signal</span> = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="params">input: RequestInfo | URL, init: RequestInit | <span class="literal">undefined</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">signal</span> = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fetch</span>(input, &#123;</span><br><span class="line">            ...(init || &#123;&#125;),</span><br><span class="line">            <span class="attr">signal</span>: <span class="variable language_">this</span>.<span class="property">signal</span>.<span class="property">signal</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">abort</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">signal</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">signal</span>.<span class="title function_">abort</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// UI ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [sendRe, setSendRe] = useState&lt;<span class="title class_">HasSignalFetch</span> | <span class="literal">undefined</span>&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleSendHtpp</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å–æ¶ˆä¸Šæ¬¡è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">if</span> (sendRe) &#123;</span><br><span class="line">      sendRe.<span class="title function_">abort</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿæˆæ–°çš„è¯·æ±‚å¹¶å‘é€</span></span><br><span class="line">    <span class="keyword">const</span> sendIns = <span class="keyword">new</span> <span class="title class_">HasSignalFetch</span>();</span><br><span class="line">    <span class="title function_">setSendRe</span>(sendIns);</span><br><span class="line"></span><br><span class="line">    sendIns</span><br><span class="line">      .<span class="title function_">fetch</span>(<span class="string">&quot;https://8q47rs.csb.app&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(</span><br><span class="line">        <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(res, <span class="string">&quot;è¯·æ±‚æˆåŠŸï¼ï¼&quot;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">warn</span>(err, <span class="string">&quot;è¯·æ±‚é”™è¯¯!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleSendHtpp&#125;</span>&gt;</span>å‘é€è¯·æ±‚<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è¶…æ—¶åœºæ™¯"><a href="#è¶…æ—¶åœºæ™¯" class="headerlink" title="è¶…æ—¶åœºæ™¯"></a>è¶…æ—¶åœºæ™¯</h3><p>æ¥å£è¶…æ—¶è®¾å®šä¸€èˆ¬éƒ½æ¥è‡ª axios ç­‰å°è£…åº“ï¼Œè¿™é‡Œä½¿ç”¨ AbortSignal.timeout å¿«é€Ÿå®ç°ä¸€ä¸ªè¶…æ—¶å–æ¶ˆè¯·æ±‚åŠŸèƒ½ã€‚å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ setTimeout å®šæ—¶å™¨ï¼Œåœ¨å®šæ—¶å™¨å›è°ƒä¸­AbortController å®ä¾‹çš„abortå‡½æ•°æ‰‹åŠ¨ä¸­æ­¢ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¶…æ—¶æ—¶é—´ 10s ï¼Œè¶…è¿‡10s è‡ªåŠ¨å–æ¶ˆ</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;&lt;https://xxx.com&gt;&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">signal</span>: <span class="title class_">AbortSignal</span>.<span class="title function_">timeout</span>(<span class="number">1000</span>*<span class="number">10</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å®šæ—¶å™¨å›è°ƒä¸­å–æ¶ˆ:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¶…æ—¶å–æ¶ˆ</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    controller.<span class="title function_">abort</span>();</span><br><span class="line">  &#125;&#125;, <span class="number">10</span>*<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&#x27;&lt;https://xxx.com&gt;&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">signal</span>: controller.<span class="property">signal</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>AbortSignal.timeout(tims) è¿”å›çš„ä¿¡å·å¯¹è±¡å®ä¾‹è®¡ç®—æ—¶é—´ä»è°ƒç”¨å¼€å§‹è®¡æ—¶ï¼Œå¹¶ä¸æ˜¯ fetch æˆ–å¼‚æ­¥å¼€å§‹æ—¶è®¡æ—¶ã€‚å‚è€ƒå¦‚ä¸‹ä»£ç ä½¿ç”¨è¯¯åŒºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// å€’è®¡æ—¶ 10s ä»timeoutå‡½æ•°è°ƒç”¨å¼€å§‹è®¡ç®—</span></span><br><span class="line">  <span class="keyword">const</span> signal = <span class="title class_">AbortSignal</span>.<span class="title function_">timeout</span>(<span class="number">8</span>*<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// è¯·æ±‚æ°¸è¿œè¶…æ—¶</span></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&#x27;&lt;https://xxx.com&gt;&#x27;</span>, &#123;</span><br><span class="line">      signal</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, <span class="number">10</span>*<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤åˆåœºæ™¯: è¶…æ—¶è‡ªåŠ¨ä¸­æ­¢å’Œå…¶ä»–æ¡ä»¶è‡ªå®šä¹‰ä¸­æ­¢<br>æ¥å£å¦‚æœè¶…è¿‡10sè¿˜æœªè¯·æ±‚å›æ¥ä¸­æ­¢æ‰ï¼Œå‚æ•°å˜æ›´è¯·æ±‚å–æ¶ˆã€‚ä¸¤ä¸ªæ¡ä»¶å‡éœ€è¦å–æ¶ˆå¼‚æ­¥æˆ–è€…è¯·æ±‚æ—¶ï¼ŒAbortSignal.timeout å°±ä¸é€‚ç”¨äº†ï¼Œåªèƒ½ä½¿ç”¨ AbortController å®ä¾‹ + setTimeout å®šæ—¶å™¨è¿›è¡Œå®ç°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HasSignalFetch</span> &#123;</span><br><span class="line">    private <span class="attr">signal</span>: <span class="title class_">AbortController</span>;</span><br><span class="line">    private <span class="attr">timeout</span>: number;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">timeout?: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">signal</span> = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timeout</span> = timeout;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¶…æ—¶è‡ªåŠ¨ä¸­æ­¢</span></span><br><span class="line">    private <span class="title function_">timeoutAutoAbort</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">timeout</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">signal</span> &amp;&amp; !<span class="variable language_">this</span>.<span class="property">signal</span>.<span class="property">signal</span>.<span class="property">aborted</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">signal</span>.<span class="title function_">abort</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="variable language_">this</span>.<span class="property">timeout</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="params">input: RequestInfo | URL, init: RequestInit | <span class="literal">undefined</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">signal</span> = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">timeoutAutoAbort</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fetch</span>(input, &#123;</span><br><span class="line">            ...(init || &#123;&#125;),</span><br><span class="line">            <span class="attr">signal</span>: <span class="variable language_">this</span>.<span class="property">signal</span>.<span class="property">signal</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">abort</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">signal</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">signal</span>.<span class="title function_">abort</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// use case</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sendIns = <span class="keyword">new</span> <span class="title class_">HasSignalFetch</span>(<span class="number">10</span> * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">        sendIns.<span class="title function_">fetch</span>(<span class="string">&#x27;https://xxx.com/a&#x27;</span>, &#123; <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span> &#125;),</span><br><span class="line">        sendIns.<span class="title function_">fetch</span>(<span class="string">&#x27;https://xxx.com/b&#x27;</span>, &#123; <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span> &#125;)</span><br><span class="line">    ]).<span class="title function_">then</span>(<span class="function">(<span class="params">resArr</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// resArr å¤„ç†å¾—åˆ°çš„æ•°æ®</span></span><br><span class="line">    &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†å¤±è´¥çš„åœºæ™¯ï¼ŒåŒ…å«è¶…æ—¶è¢«ç»ˆæ­¢ï¼Œæ‰‹åŠ¨ä¸­æ­¢ï¼Œè¯·æ±‚é”™è¯¯ç­‰ç­‰ï¼</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ¨¡å—å°è£…è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°å¼‚æ­¥&#x2F;å°¤å…¶æ˜¯åŒ…å«ç½‘ç»œè¯·æ±‚ç­‰åœºæ™¯ï¼Œéƒ½åº”è¯¥æä¾›ä¸­æ­¢å¼‚æ­¥ï¼Œè¶…æ—¶ä¸­æ­¢ç­‰åŸºç¡€èƒ½åŠ›ã€‚æ¨¡å—å¤ç”¨å’Œå¥å£®ç¨‹åºéœ€è¦æ›´å¤šè€ƒè™‘åˆ°ç‰¹æ®Šåœºæ™¯ï¼ˆå–æ¶ˆè¿‡æœŸè¯·æ±‚ï¼›ä¸­æ­¢è¶…æ—¶çš„è®¡ç®—ç­‰ç­‰ï¼‰ã€‚</p>
]]></content>
      <categories>
        <category>PROGRAMMING</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>code</tag>
      </tags>
  </entry>
  <entry>
    <title>å†é‡å¤´æ”¶æ‹¾æ—§æ²³å±±</title>
    <url>/ron.github.io/2024/11/18/%E5%86%8D%E9%87%8D%E5%A4%B4%E6%94%B6%E6%8B%BE%E6%97%A7%E6%B2%B3%E5%B1%B1/</url>
    <content><![CDATA[<p>è¿™æ˜¯ä¸€ç¯‡å…³äºæŒ£æ‰åœ¨æ³¥æ½­ä¹‹ä¸­çš„çŒ´å­ï¼Œæ€è€ƒè§£æ•‘è‡ªå·±çš„ç¢ç‰‡ã€‚çŸ›ç›¾ï¼Œæ‹§å·´ï¼Œæ‰¾åˆ°ä¸€äº›æ–¹å¼è§£æ•‘è‡ªå·±ï¼Œç–äºç®¡ç†å’Œæ‰§è¡ŒåŠ›ç¼ºä¹çŒ´å­åˆé‡æ–°å›åˆ°äº†æ‹§å·´ï¼ŒçŸ›ç›¾ï¼Œè¿™ä¸ªè½®å›ä¹‹ä¸­ã€‚<br>æˆ‘éœ€è¦æŒ£é’±ç”¨ä»¥æ¢å»ç”Ÿæ´»æ‰€éœ€ï¼Œåˆæƒ³åšè‡ªå·±å–œæ¬¢çš„äº‹æƒ…ã€‚åœ¨ä¸¤è€…ä¹‹é—´æ‰¾åˆ°ä¸€æ¡è·¯å¾„â€“ç¼–ç¨‹ã€‚æƒ³è¦é ç¼–ç¨‹è¿‡çš„æ›´å¥½ï¼Œåœ¨æˆ‘çœ‹æ¥å°±æœ‰éå¸¸å¯è¡Œçš„ä¸¤æ¡è·¯å¾„ã€‚å…¶ä¸€ï¼šè·³æ§½æ¢ä¸ªå…¬å¸æ¶¨è–ªï¼ŒçŸ­æœŸå¯å®ç°30%å·¥èµ„çš„æ¶¨å¹…ã€‚å…¶äºŒï¼šå¼€å‘ä¸€æ¬¾ä¸ªäººäº§å“ï¼Œç¼“æ…¢æŒ£é’±ã€‚åœ¨æˆ‘çœ‹æ¥ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜åŠ¿ï¼Œå¹¶ä¸”æˆ‘éƒ½æµ…å°å³æ­¢ï¼Œè¿™æ˜¯ä¸ªä¸å¥½çš„å¾å…†ã€‚æˆ‘æ›¾åŒ†åŒ†å‡†å¤‡é¢è¯•äº†ä¸¤å®¶å²—ä½ï¼Œå¤±è´¥å‘Šç»ˆï¼›æˆ‘çš„ä¸¤æ¬¾äº§å“åœ¨å¯åŠ¨å¼€å‘ååŠŸèƒ½è¾¾åˆ°30%æ—¶çªç„¶æš‚åœå¼€å‘ï¼Œæ‰§è¡ŒåŠ›ä½æ˜¯ä¸€ä¸ªéå¸¸è¦å‘½çš„ç¼ºç‚¹ã€‚æˆ‘å‘ç°äº†~ æˆ‘çš„å¾ˆå¤šä¸æˆäº‹çš„ç¼ºç‚¹ï¼Œä¸€ç‚¹ç‚¹æ”¹æ­£ï¼Œå†é‡å¤´æ”¶æ‹¾æ—§æ²³å±±ã€‚</p>
<h2 id="åšæˆä¹‹å‰ï¼Œä¸è¦è°ˆè®º"><a href="#åšæˆä¹‹å‰ï¼Œä¸è¦è°ˆè®º" class="headerlink" title="åšæˆä¹‹å‰ï¼Œä¸è¦è°ˆè®º"></a>åšæˆä¹‹å‰ï¼Œä¸è¦è°ˆè®º</h2><p>åšå¥½å†³å®šå¿«é€ŸéªŒè¯å¹¶å¯åŠ¨ã€‚ä¸€æ—¦å¯åŠ¨åªæœ‰ä¸¤ä¸ªç»“æœï¼Œå¼€å‘å®Œæˆå¤§åŠŸå‘Šæˆï¼Œå¼€å‘å®Œæˆä¸åŠé¢„æœŸã€‚å‰æä¸€å®šæ˜¯ <strong>å¼€å‘å®Œæˆ</strong>. æŒ‰ç…§è®¡åˆ’ï¼Œå®Œå®Œæ•´æ•´çš„æå®šä¸€ä»¶äº‹æƒ…ï¼Œè¿™æ˜¯æ‰§è¡ŒåŠ›maxã€‚<br>å¦å¤–ä¸€ç‚¹ï¼Œåšæˆä¹‹å‰ä¸è¦å’Œåˆ«äººè°ˆè®ºå®ƒã€‚æˆ‘çš„ä¸¤ä¸ªäº§å“åœ¨è®¾è®¡é˜¶æ®µï¼Œå·²ç»å¼€å§‹å’ŒåŒäº‹ã€å®¶äººåˆ†äº«ï¼Œæˆ‘ä»¬è°ˆè®ºå…¶ä¸­çš„å¯è¡Œæ€§ï¼Œè°ˆè®ºä¸€æ—¦æˆåŠŸä¼šæœ‰å“ªäº›å¥½å¤„ã€‚å¯æ˜¯ï¼å¯æ˜¯ï¼äº‹æƒ…è¿˜æ²¡åšæˆï¼ï¼ï¼<br>è®¤çœŸåšå†³å®šï¼Œæœ€å¥½æ˜¯ç‹¬å¤„æ—¶ç»è¿‡è®¤çœŸæ€è€ƒåˆ†æï¼ˆä»å½“å‰èƒ½çœ‹åˆ°çš„å„ä¸ªæ–¹é¢ï¼Œå¯è¡Œæ€§ã€æˆæœ¬ã€é¢„ä¼°æ”¶ç›Šå’Œç«äº‰ç­‰ç­‰ï¼‰ã€‚ä¸€æ—¦ä¸‹å®šå†³å¿ƒï¼Œç«‹å³è¡ŒåŠ¨ã€‚ä»¥æœ€å¤§æŠ•å…¥æ¨åŠ¨é¡¹ç›®è¿›å±•ï¼Œä¸ç»™è‡ªå·±è®¾ç½®é™åˆ¶ï¼ˆé¢„è®¡1ä¸ªæœˆå¼€å‘å®Œæˆï¼‰ï¼Œä½†æ˜¯å¾ˆå¯èƒ½ä¸‰å¤©å°±èƒ½æå®šï¼Œæˆ‘ç»å¸¸ç»™è‡ªå·±è®¾ç½®æœŸé™ï¼Œè¿™æ˜¯æˆ‘æ‹–å»¶çš„åŸå› ä¹‹ä¸€ã€‚</p>
<h2 id="äº«å—ç‹¬å¤„"><a href="#äº«å—ç‹¬å¤„" class="headerlink" title="äº«å—ç‹¬å¤„"></a>äº«å—ç‹¬å¤„</h2><p>ä¸ªäººç‹¬å¤„æ—¶ï¼Œæˆ‘æ›´èƒ½åæ€è‡ªå·±åšçš„å†³å®šï¼Œè¯´è¿‡çš„è¯ã€‚å“ªäº›æ˜¯å¯¹çš„ï¼Ÿå“ªäº›æ˜¯æ„šè ¢çš„ï¼Ÿæ€è€ƒçœ‹è§åˆ«äººåšçš„äº‹æƒ…ï¼Œé€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›å¯ä»¥å€Ÿé‰´å‚è€ƒã€‚å’Œåˆ«äººç›¸å¤„ï¼Œéœ€è¦å®æ—¶å“åº”ï¼Œå›åº”åˆ«äººçš„è¯é¢˜ï¼ŒæŠ–ä¸ªæœºçµå¼€å¿ƒä¸€ä¸‹ï¼Œå›ç­”åˆè¦é¿å…è¯´é”™è¯ï¼Œè¿™äº›ç”±å¤´éƒ½ç»™æ€§èƒ½ä¸ç®—å¥½çš„CPUé€ æˆéº»çƒ¦ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘éœ€è¦å¤šåˆ¶é€ ç‹¬å¤„æ—¶é—´ã€‚æˆ‘å’Œå¤«äººå…»äº†ä¸€åªçŒ«ã€‚åå­—å«åšâ€œæé€µâ€ï¼Œæ˜¯ä¸€ä¸ªèƒ†å­å¾ˆå°åˆç²˜äººçš„ç”·å­©ã€‚å®¶é‡Œæœ‰å¤«äººå’ŒçŒ«ï¼Œåœ¨å®¶é‡Œæ˜¯æ²¡æ³•åšåˆ°ç‹¬å¤„çš„ï¼Œå› æ­¤æˆ‘çš„ç‹¬å¤„æ˜¯ç¯®çƒåœºå’Œå…¬å¸ã€‚åœ¨å®¶é‡Œäº«å—é™ªä¼´ï¼Œä½†æ˜¯æ§åˆ¶æ—¶é—´ã€‚</p>
<h2 id="å°‘è¯´å°‘é”™ï¼Œå‡å°‘æŠ±æ€¨"><a href="#å°‘è¯´å°‘é”™ï¼Œå‡å°‘æŠ±æ€¨" class="headerlink" title="å°‘è¯´å°‘é”™ï¼Œå‡å°‘æŠ±æ€¨"></a>å°‘è¯´å°‘é”™ï¼Œå‡å°‘æŠ±æ€¨</h2><p>æˆ‘è¿˜æœ‰ä¸€ä»½å·¥ä½œï¼Œæˆ‘æœ‰ä¸€ä¸ªæ¯›ç—…ï¼Œå¯¹äºåƒåœ¾ä»£ç å®¹å¿åº¦éå¸¸ä½ã€‚åœ¨åˆ«äººæ—§ä»£ç ä¸Šåšæ›´æ–°æ—¶ï¼Œå°¤å…¶æ˜¯å†™çš„ä¸åˆç†çš„ä»£ç ï¼Œæˆ‘ä¹ æƒ¯æ€§çš„å˜€å’• â€œå†™çš„ä»€ä¹ˆç©æ„å„¿ï¼Ÿâ€ã€‚ ç”šè‡³ä¼šç»™èº«è¾¹åŒäº‹åæ§½ï¼Œè¿™ä¸ªä»£ç å®ç°çš„çœŸæ˜¯æƒ¨ä¸å¿ç¹ï¼Œæ¥ä½ çœ‹çœ‹è¿™é‡Œå†™çš„ç¡¬ç¼–ç ï¼Œè¿™é‡Œåˆé‡å¤å®ç°ä¸€éåŒæ ·çš„é€»è¾‘ï¼Œè¿™é‡Œå†™çš„ä¼šè§¦å‘æ²¡å¿…è¦çš„è®¡ç®—å’Œæ›´æ–°â€¦ã€‚æˆ‘æƒ³æˆ‘çš„åŒäº‹ä»¬ï¼Œå› è¯¥å¾ˆåæ„Ÿè¿™ç§è¡Œä¸ºå§ã€‚æ˜¯åƒåœ¾ä»£ç ï¼Œä½ é‡æ„ä¸å°±å®Œäº†å—ï¼Ÿæ¯å¤©éƒ½åœ¨åæ§½ä¸ªå•¥å‘¢ï¼Ÿ</p>
<p>æ˜¯çš„ï¼Œè¿™ä¸ªæ¯›ç—…å·²ç»åœ¨çº æ­£äº†ã€‚å‡å°‘è´Ÿé¢æƒ…ç»ªæµå‡ºï¼Œæˆ‘çš„æ–¹æ³•æ˜¯å†™åˆ°åšå®¢&#x2F;æ ‘æ´ç¬”è®°é‡Œé¢å»ï¼Œå˜´ä¸Šä¸è¯´å‡ºæ¥ã€‚</p>
<h2 id="ç¯®çƒå’Œç¼–ç¨‹"><a href="#ç¯®çƒå’Œç¼–ç¨‹" class="headerlink" title="ç¯®çƒå’Œç¼–ç¨‹"></a>ç¯®çƒå’Œç¼–ç¨‹</h2><p>åšæŒå¥èº«è¿åŠ¨å¤§æ¦‚æœ‰ä¸‰å¹´çš„æ—¶é—´ï¼Œç–«æƒ…åŸå› ä¸­æ–­ä¸€æ®µæ—¶é—´ã€‚22å¹´åº•å½“æˆ‘é‡æ–°å›åˆ°å¥èº«æˆ¿ï¼Œæˆ‘å¼€å§‹ç»ƒä¹ æ¸¸æ³³ï¼›è¶³çƒï¼›ç¯®çƒï¼›ç¾½æ¯›çƒï¼Œæˆ‘æ˜¯çœŸçš„å‚ä¸äº†ã€‚æ¯ä¸ªé¡¹ç›®éƒ½æ˜¯æµ…å°å³æ­¢ã€‚æ¸¸æ³³åªä¼šè›™æ³³ï¼Œè¶³çƒç»ƒä¹ äº†ä¸€æ®µæ—¶é—´ï¼Œç¾½æ¯›çƒä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ²¡æœ‰æŠŠä¸€ä¸ªè¿åŠ¨çœŸçœŸçš„ç»ƒå¥½ã€‚24å¹´10æœˆï¼Œæˆ‘å¼€å§‹æ„è¯†åˆ°æˆ‘åº”è¯¥è®¤çœŸçš„è®­ç»ƒç¯®çƒï¼Œå…¶ä»–å…´è¶£æš‚åœã€‚æˆä¸ºæŸä¸€é¡¹è¿åŠ¨çš„ä¸“ä¸šçˆ±å¥½è€…ï¼Œè€Œä¸æ˜¯èƒ½åŠ›éå¸¸æ™®é€šçš„çˆ±å¥½è€…ã€‚</p>
<p>å¼€å¯äº†ç¯®çƒä¸“é¡¹è®­ç»ƒï¼Œæˆ‘å¼€å§‹æ‹†è§£ä¸“é¡¹ï¼šçº æ­£æŠ•ç¯®ã€ç»ƒä¹ è¿çƒè¿‡äººâ€¦çªç ´ã€è„šæ­¥â€¦ã€è·‘ä½å’Œé˜²å®ˆç­‰ç­‰ã€‚è®­ç»ƒå¹¶ä¸æ— èŠï¼Œå¾ˆå¤šåŠ¨ä½œè‡ªå·±æ„è¯†ä¸åˆ°ï¼Œå®é™…æ˜¯é”™è¯¯çš„ï¼Œé€šè¿‡æ‰‹æœºåœ¨è¾¹ä¸Šå½•åˆ¶è§†é¢‘ï¼Œå›çœ‹å°±èƒ½å‘ç°è¿™ä¸ªé—®é¢˜ï¼Œçº æ­£åŠ¨ä½œå†é‡å¤ç»ƒä¹ ï¼ŒæŸ¥çœ‹æ•™ç¨‹è§†é¢‘ã€‚ç°åœ¨æŠ•ç¯®åŠ¨ä½œæ ‡å‡†äº†ä¸å°‘ï¼Œä½†æ˜¯å‘åŠ›ä»ç„¶ä¸æµç•…ï¼ˆä¸€æ®µå¼ï¼‰ã€‚<br>å› æ­¤æˆ‘å‘ç°ï¼šè¡ŒåŠ¨ -&gt; åé¦ˆ -&gt; ä¿®æ­£ -&gt; è¡ŒåŠ¨ ~ è¿™æ˜¯ä¸€ä¸ªæ­£å‘å¾ªç¯å…¬å¼ã€‚å‘ç°é”™è¯¯&#x2F;è´Ÿé¢åé¦ˆå¹¶ä¸æ˜¯å¤±è´¥ï¼Œä»–åªæ˜¯ä¸€ä¸ªåé¦ˆ feedback ã€‚ç¯®çƒè®­ç»ƒæˆ‘å¯ä»¥é€šè¿‡è§†é¢‘å½•åˆ¶çš„æ–¹å¼æ¥å‘ç°é—®é¢˜ï¼Œç¼–ç¨‹å·¥ä½œä¸­çš„åé¦ˆæ­å»ºå°±è¦å›°éš¾çš„å¤šã€‚å¤§éƒ¨åˆ†æ—¶å€™æˆ‘æ½œæ„è¯†é‡Œé¢ä¹Ÿå¿½ç•¥äº†è¿™éƒ¨åˆ†åé¦ˆï¼</p>
<p>å¦‚æœæœ‰ä¸€ä¸ªäººç»å¸¸æŒ‡å‡ºæˆ‘çš„é—®é¢˜ï¼Œæˆ‘åº”è¯¥è¦æ„Ÿè°¢ä»–ã€‚ä½†æ˜¯ç¢äºå„ç§æƒ…é¢ï¼Œå¾€å¾€éƒ½å¾ˆéš¾å¾—åˆ°è¿™ç§åé¦ˆã€‚</p>
<p>å†é‡å¤´æ”¶æ‹¾æ—§æ²³å±±ï¼Œè¿™ä¸€å¥éå¸¸æœ‰æ°”åŠ¿~ ç”¨æ¥ç»“æŸè¿™ç¯‡ç¢ç¢å¿µã€‚é‡æ–°æ¢å¤äº† 6.40 æ—©èµ·ï¼Œé‡æ–°æˆ’æ–­çŸ­è§†é¢‘å’Œç¤¾äº¤appï¼Œç²¾åŠ›é‡æ–°å›åˆ°ç¼–ç¨‹å’Œç¯®çƒä¸Šå»ã€‚</p>
]]></content>
      <tags>
        <tag>é—²è¨€ç¢è¯­</tag>
      </tags>
  </entry>
</search>
